<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1">
        <meta charset="utf-8">
        <meta name="theme-color" content="#222222">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAGACGAAAAFgAAAIlQTkcNChoKAAAADUlIRFIAAAAQAAAAEAgGAAAAH/P/YQAAAE1JREFUOI1j/P//PwOxgNGeAUMxE9G6cQCKDWAhpADZ2f8PMjBS3QW08QK20KaZC2gfC9hCnqouoNgARgY7zMxAyNlUdQHlXiAlO2MDAD63EVqNHAe0AAAAAElFTkSuQmCC">
        <title>DUNEWEAVER</title>
        <script>
            function feedback() {}
            var h = document.getElementsByTagName("head")[0]
              , l = document.createElement("script");
            l.type = "application/javascript",
            l.src = "./static/js/iro.js",
            l.addEventListener("load", e => {
                cpick = new iro.ColorPicker("#picker",{
                    width: 260,
                    wheelLightness: !1,
                    wheelAngle: 270,
                    wheelDirection: "clockwise",
                    layout: [{
                        component: iro.ui.Wheel,
                        options: {}
                    }]
                }),
                cpick.on("input:end", () => {
                    setColor(1)
                }
                ),
                cpick.on("color:change", () => {
                    updatePSliders()
                }
                );
                var t = document.createElement("script");
                t.type = "application/javascript",
                t.src = "./static/js/rangetouch.js",
                t.addEventListener("load", e => {
                    ranges = RangeTouch.setup('input[type="range"]', {});
                    let t = setInterval( () => {
                        "complete" === document.readyState && (clearInterval(t),
                        onLoad())
                    }
                    , 100)
                }
                ),
                setTimeout( () => {
                    h.appendChild(t)
                }
                , 100)
            }
            ),
            setTimeout( () => {
                h.appendChild(l)
            }
            , 100)
        </script>
        <style>
            @font-face {
                font-family: WIcons;
                src: url(data:font/woff2;charset=utf-8;base64,d09GMgABAAAAAAnUAAsAAAAAE1AAAAmFAAGZmgAAAAAAAAAAAAAAAAAAAAAAAAAABmAAgXwRCAqcYJZIATYCJANwCzoABCAFgwYHIBs7D8iOwzgm3MXMnzZCktnjcbN+QlJLaJ3ulULplpW6UqWioeS91Jye0jUlJwZr5nTdE3LntdPvAg+ft/fbsLsGlNLuhlmQjKi7NPDEIgwTmP//a6mdl+SHUBhEIdHFxak7s4E/yzhJSjC7BQQLfDwopF/i6aqSElEFDXx8ZVWjy3rym4N6FlZQ4hu+nXsGIDMQF3gAxa14AgArtVMhfkgjfEAbiChwuSIwEUCmudPhiQdT6rvIjLSRZEwDhF9BIsooI53TIRIoIUD8kyNZI7UjAyMrR/aM/DwaOpozah9LGCsY2zN2YOzs2L3xqeNp4zXjq8bXT/hMBLj/53YDAIS+7u668n3H+HRPdZd1u3TzdRZdVMTfIl5HfKgd1b7Svqd9W9uprdP8QTOmeaz5TPORJlDDjHVjG0ANMQYsmRrKlmpyqV7kubIQC2GSIkFS+MneCJ48JJFVChQfuwKMp2yU9pmq1VKUR6ret0Gp0SjVYRRF+Xj7+OiUSk/GIzu1miHZWx+g8Y1RUktPmqIitRTXVNzzCtuFPKcH0zRBG+Y9/CnhBa20v5oHfsEUMgXMPEfO5ZcJx0FIPiVywgjb6MIuV+oZ4v2kk6/znIxDKrguM22y+bW8wUGqi7aL8fQJzwnCj8tIppdI9bYDSVJVCQInipW0HbtclcT7vCyLmXaSVrQSNMybaJJBh2PiXrXbgd6AbqecdDTO9EQEIeW0VPWQcdQ8ltPOEu+76q2IxUToJeWpfjQiHHH5AsADLj1bHgQxXsUoHfKYbg+CxCxC69eHcOvWheJ1l6b0nD7jG+bSA1dCZVxmw8ZJ/IYtxPtbJxlpQ/LGjSq00TmdNIZxrGel+y+rZJro+nUh3PrNIGwK6WrXNMV2xTeRWHSjScktLJfe1rc7spyvk3b6V4k48Sr3Am1Pv/QifhsI2uMvc863OiQQRNoedpPfHnSwcete+aDEE67cKzTgBlQgjpjgTDnJtGnX2qbmXJ6FOBLZ7wsr+JZzYnbjdbkCuEfU0HvlwqbtUgJ7zRXFNJsvSxlwz2WYta4xjri/fsulnnFVPyonpP0RL5oVNKkkfElG4csTDNAsgzC38G7gSKVgSZ7m/cEvKALmxKz//u7h6egHF7MrH4jJp/Zx4q32a8T71xnHVRCGlfFZNttd2FcUaay6e9PkhucyR0oPu1z1z/DB+8wixAFdMU1gnmB4xAw68pwHcWjlFrBnXxLjj63UGgvNGVGAJFzxFw+Womn7MAibVbu6leHRB5sc10fLtbrdr/JqV6Yr+ovwFtRHE7M4zG90qNB6YREoo51kFJabq3NeHVKdef/hsMFFSpt5m8XmJqDDAnR0c418mxmxrQzQuyPnspRwfAYkpthzr7gST1xNSf4WtBMM9DQT19uL+gb47gFLP3cT08F8I4dZxJl41Gsx9WHzLBOHzWjRS9NLCOUBCFQ+uGhB/V7ZzUwKESTmDriJ+UecdD/bFXFMLLsjgiAt4pp7ulpxb2tzE8I8xhyHODBK3SGg6QP12BiP3YMw2rDFtWUDXL+esnv3H9QxqfmbDnbMLjGUFpqqZbnWSg0lhWv9wU35qTHqP9zqUrL7kqKj8YjZzg01pb9+yQ8sXZpYxKGiFJTNsIwwpyR44gEOnV/+ennFdHD/2lQ3uS5y1qzIztXUNPE6odYJ0PqUiWJtgKGKMILY60dxeYynbb+sFKKqNn0Wz2rLtMbBQWPnYtmJa4WqFRob/9mmuycQVv7ifCNvXrlhzgDLDvAGA+8H5xjK948cDet+FaXfS+Lko/Wt+vScqarq6kZTbk4NaKqpObkEEpsac9L1rRNXJgPbrWyDdYje6tBQAztkbYC0wDe4UnNipmnZtInu/ujf6Kf7ve112Huf92Ev/7enB/+nP7pbrPiQJZbi0jCSpoN9UNPTkj7JMwpbWgopAbhtbOWkytAF3K+/qo0SASNW2G2bLfnshpB4a9dmz7/Hx//dc3OXNZ46YRyXUV2dYRsD97qKL79qazu+vSI1vPXT7375bWSGocBofD2eIRzJ0cMC0tenwQ0gfvuSdvd14f1uEooLPE3JJHL6uCd/n5n8d35UOKPn6nhr8kyrV3ad3nz2iTiNL414EnefL/JGLlWZtZWaqoEh4xSjvsGb/6m9raFlsLm4uHkQWlv7T/weZzjHHe7xZiUzpJ5WAWBLDNwRKxwRYnFoXGxcaKxN6DR8BNn2o9Nqmmutvra5TnIjXMBlmIFZ3yPYX3Mt9v5mmHuwYvvxPverL9eSvszXNjUXrkbqcGOVW2bEbDGKi3MLVTWzzWHF54Bu/2rA1qko6l9fFgVbBurfVBWFFlVW1ugxOwcs+8W//FcUZJieLl9WXA8eGL5crB7fhOMyxl8bjQWGjB1bW/ok6Ucqensr7F8H7utsmdqoHmz99rvyeE/Pz7u64mvVXLjyY8v8j5XhZeH3aPX75dpiO5eN/OzwcG7zkflt/sd5e7YcqbOowfRg22R5585at2vXX87W1Y0gQ079497eYT1EkyoEqMYABmHd8QvKGrRG6bJYTDCCZYGEWcm5G1jXM2i54Y9WtiBuklP57YtBZMAWlu2fYzDM7Q+5FmxKS3Oz5jwK6IactbWPowuQgNyHluKlaw9wnbOmtuajo/VSw9FrBSRwMcuUV2ZwFhh6s7hsqriWCsgA2s3nFcri4I7O+asxwxZbtLL03E9bhcR6Yz9mIbF0U96K0xGA7bx9y+l2//73j+H2i0EGd27uAVNI/WhCYuWqIDaYxads0lcVFV+dOlHmBx/qO7c6/uZX0tReUtJQv64y3adAvX6xDezAX/8Wm8Cgh/95O9OxsNCYnsXWQ+7pCz8/NMZ57ZAIGEdTw+ap8V+I3NUVe375wiv+lccqj172X7Yw5gJAUQGYPQ6QyxRfgeC+Qc5WnAMCAHFv6TJtet3pn/83b4YCAIBv35ofpTRyt5PjZEwT8KYAEQK8nFgBcE/yUwn2oqHSBKoEG7KZQLMpjo5uha/PI2yuBWOCTSDZajpqQ68+Za18jgGgYMT8nBhjKcFrKCYF6yKSZRLF5tR5YKhUzzNWM52mBvuPMiL7xPx4UaRgFiJZAVFscZ2HUIhUPcEaH5WWDvvmvdPfl5KaCvO8o1+fFCBb6hvuLz8lMROwfjPN8iar90RCCiRCJr3ugqHf6LqgUYYs5hzvu9tMIOUr/xpvRsNVvdZ/p+mB8n7V2Spo0T+aRhPpNhsNFOqxoE2u0suqTipgx58IJA0AAAA=) format('woff')
            }

            :root {
                --c-1: #111;
                --c-f: #fff;
                --c-2: #222;
                --c-3: #333;
                --c-4: #444;
                --c-5: #555;
                --c-6: #666;
                --c-8: #888;
                --c-b: #bbb;
                --c-c: #ccc;
                --c-e: #eee;
                --c-d: #ddd;
                --c-r: #c32;
                --c-g: #2c1;
                --c-l: #48a;
                --c-y: #a90;
                --t-b: 0.5;
                --c-o: rgba(34, 34, 34, 0.9);
                --c-tb: rgba(34, 34, 34, var(--t-b));
                --c-tba: rgba(102, 102, 102, var(--t-b));
                --c-tbh: rgba(51, 51, 51, var(--t-b));
                --th: 70px;
                --tp: 70px;
                --bh: 63px;
                --tbp: 14px 14px 10px 14px;
                --bbp: 9px 0 7px 0;
                --bhd: none;
                --sgp: "block";
                --bmt: 0px
            }

            html {
                touch-action: manipulation
            }

            body {
                margin: 0;
                background-color: var(--c-1);
                font-family: Helvetica,Verdana,sans-serif;
                font-size: 17px;
                color: var(--c-f);
                text-align: center;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                -webkit-tap-highlight-color: transparent;
                scrollbar-width: 6px;
                scrollbar-color: var(--c-sb) transparent
            }

            body,html {
                height: 100%;
                width: 100%;
                position: fixed;
                overscroll-behavior: none
            }

            #bg {
                height: 100vh;
                width: 100vw;
                position: fixed;
                z-index: -10;
                background-position: center;
                background-repeat: no-repeat;
                background-size: cover;
                opacity: 0;
                transition: opacity 2s
            }

            p {
                margin: 10px 0 2px 0
            }

            a,a:visited,p {
                color: var(--c-d)
            }

            a,a:visited {
                text-decoration: none
            }

            button {
                outline: 0;
                cursor: pointer
            }

            .labels {
                margin: 0;
                padding: 8px 0 2px 0
            }

            #namelabel {
                position: fixed;
                bottom: calc(var(--bh) + 6px);
                right: 6px;
                color: var(--c-8);
                cursor: pointer;
                writing-mode: vertical-rl
            }

            .bri {
                padding: 4px
            }

            .wrapper {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: var(--c-tb);
                z-index: 1
            }

            .icons {
                font-family: WIcons;
                font-style: normal;
                font-size: 24px!important;
                line-height: 1!important;
                display: inline-block
            }

            .on {
                color: var(--c-g)!important
            }

            .off {
                color: var(--c-6)!important
            }

            .bot .icons,.top .icons {
                margin: -2px 0 4px 0
            }

            .huge {
                font-size: 42px
            }

            .plentry TABLE,.segt {
                table-layout: fixed;
                width: 100%
            }

            .segt TD {
                padding: 2px 0!important;
                text-align: center
            }

            .plentry TD,.segt TD {
                font-size: 13px;
                padding: 0;
                vertical-align: middle
            }

            .keytd {
                text-align: left
            }

            .valtd {
                text-align: right
            }

            .valtd i {
                font-size: small
            }

            .slider-icon {
                position: absolute;
                left: 8px;
                bottom: 5px
            }

            .sel-icon {
                transform: translateX(3px)
            }

            .e-icon,.g-icon,.sel-icon,.slider-icon {
                cursor: pointer;
                color: var(--c-d)
            }

            .g-icon {
                font-style: normal;
                position: absolute;
                top: 8px;
                right: 8px
            }

            .pop {
                position: absolute;
                display: inline-block;
                top: 0;
                right: 0
            }

            .pop-c {
                position: absolute;
                background-color: var(--c-2);
                border: 1px solid var(--c-8);
                border-radius: 20px;
                z-index: 1;
                top: 3px;
                right: 35px;
                padding: 3px 8px 1px;
                font-size: 24px;
                line-height: 24px
            }

            .pop-c span {
                padding: 2px 6px
            }

            .search-icon {
                position: absolute;
                top: 8px;
                left: 12px;
                width: 24px;
                height: 24px
            }

            .clear-icon {
                position: absolute;
                top: 8px;
                right: 9px;
                cursor: pointer
            }

            .flr {
                color: var(--c-f);
                transform: rotate(0);
                transition: transform .3s;
                position: absolute;
                top: 0;
                right: 0;
                padding: 8px
            }

            .exp,.expanded .flr {
                transform: rotate(180deg)
            }

            .il {
                display: inline-block;
                vertical-align: middle
            }

            #liveview {
                height: 4px;
                width: 100%;
                border: 0
            }

            #liveview2D {
                height: 90%;
                width: 90%;
                border: 0;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%,-50%)
            }

            .tab {
                background-color: transparent;
                color: var(--c-d)
            }

            .bot {
                position: fixed;
                bottom: 0;
                left: 0;
                width: 100%;
                background-color: var(--c-tb)
            }

            .tab button {
                background-color: transparent;
                float: left;
                border: none;
                transition: color .3s,background-color .3s;
                font-size: 17px;
                color: var(--c-c);
                min-width: 44px
            }

            .top button {
                padding: var(--tbp);
                margin: 0
            }

            .bot button {
                padding: var(--bbp);
                width: 25%;
                margin: 0
            }

            .tab button:hover {
                background-color: var(--c-tbh);
                color: var(--c-e)
            }

            .tab button.active {
                background-color: var(--c-tba)!important;
                color: var(--c-f)
            }

            .active {
                background-color: var(--c-6)!important;
                color: var(--c-f)
            }

            .container {
                --n: 1;
                width: 100%;
                width: calc(var(--n)*100%);
                height: calc(100% - var(--tp) - var(--bh));
                margin-top: var(--tp);
                transform: translate(calc(var(--i,0)/ var(--n)*-100%));
                overscroll-behavior: none
            }

            .tabcontent {
                float: left;
                position: relative;
                width: 100%;
                width: calc(100%/var(--n));
                box-sizing: border-box;
                border: 0;
                overflow: auto;
                height: 100%;
                overscroll-behavior: none;
                padding: 0 4px;
                -webkit-overflow-scrolling: touch
            }

            #fx,#palw,#pcont,#pql,#putil,#segcont,#segutil,#segutil2,.fnd {
                max-width: 280px;
                font-size: 19px
            }

            #putil,#segutil,#segutil2 {
                min-height: 42px;
                margin: 13px auto 0
            }

            #segutil .segin {
                padding-top: 12px
            }

            #fx,#hexw,#ledmap,#pall,#pcont,#picker,#pql,#qcs-w,#segcont,#sliders,.filter,.fnd,.option,.pname,.segname,.slider {
                margin: 0 auto
            }

            #putil {
                padding: 5px 0 0
            }

            .smooth {
                transition: transform calc(var(--f,1)*.5s) ease-out
            }

            .tab-label {
                margin: 0 0 -5px 0;
                padding-bottom: 4px;
                display: var(--bhd)
            }

            .overlay {
                position: fixed;
                height: 100%;
                width: 100%;
                top: 0;
                left: 0;
                background-color: var(--c-3);
                font-size: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 11;
                opacity: .95;
                transition: .7s;
                pointer-events: none
            }

            .staybot,.staytop {
                display: block;
                position: -webkit-sticky;
                position: sticky!important;
                top: 0;
                z-index: 2;
                margin: 0 auto auto
            }

            .staybot {
                bottom: 5px
            }

            #sliders {
                position: -webkit-sticky;
                position: sticky;
                bottom: 0;
                max-width: 300px
            }

            #sliders .labels {
                padding-top: 3px;
                font-size: small
            }

            .slider {
                border-radius: 24px;
                position: relative;
                padding-bottom: 2px
            }

            .sliderwrap {
                height: 30px;
                width: 230px;
                max-width: 230px;
                position: relative;
                z-index: 0
            }

            #sliders .slider {
                padding-right: 64px
            }

            #info .slider,#sliders .slider {
                background-color: var(--c-2)
            }

            #sliders .sliderwrap,.sbs .sliderwrap {
                left: 32px
            }

            .filter,.option {
                background-color: var(--c-4);
                border-radius: 26px;
                height: 26px;
                max-width: 300px;
                padding: 4px 2px;
                position: relative;
                opacity: 1;
                transition: opacity .5s linear,height .5s,transform .5s
            }

            .filter {
                z-index: 1;
                overflow: hidden
            }

            .option .tooltiptext,.slider .tooltiptext {
                visibility: hidden;
                background-color: var(--c-5);
                box-shadow: 4px 4px 10px 4px var(--c-1);
                color: var(--c-f);
                text-align: center;
                padding: 4px 8px;
                border-radius: 6px;
                width: 160px;
                position: absolute;
                z-index: 1;
                bottom: 80%;
                left: 50%;
                margin-left: -92px;
                pointer-events: none;
                opacity: 0;
                transition: opacity .75s
            }

            .option .tooltiptext {
                bottom: 120%
            }

            .option .tooltiptext::after,.slider .tooltiptext::after {
                content: "";
                position: absolute;
                top: 100%;
                left: 50%;
                margin-left: -5px;
                border-width: 5px;
                border-style: solid;
                border-color: var(--c-5) transparent transparent transparent
            }

            .option .check:hover .tooltiptext,.slider:hover .tooltiptext {
                visibility: visible;
                opacity: 1
            }

            .fade {
                visibility: hidden;
                opacity: 0;
                transform: scaleY(0);
                height: 0;
                padding: 0
            }

            .first {
                margin-top: 10px
            }

            #toast {
                opacity: 0;
                background-color: var(--c-5);
                border: 1px solid var(--c-2);
                max-width: 90%;
                color: var(--c-f);
                text-align: center;
                border-radius: 5px;
                padding: 22px;
                position: fixed;
                z-index: 5;
                left: 50%;
                transform: translateX(-50%);
                bottom: calc(var(--bh) + 22px);
                font-size: 17px;
                pointer-events: none
            }

            #toast.show {
                opacity: 1;
                animation: fadein .5s,fadein .5s 2.5s reverse
            }

            #toast.error {
                opacity: 1;
                background-color: #b21;
                animation: fadein .5s
            }

            .modal {
                position: fixed;
                left: 0;
                bottom: 0;
                right: 0;
                top: calc(var(--th) - 1px);
                background-color: var(--c-o);
                transform: translateY(100%);
                transition: transform .4s;
                padding: 8px;
                font-size: 20px;
                overflow: auto
            }

            .close {
                position: -webkit-sticky;
                position: sticky;
                top: 0;
                float: right
            }

            #info,#nodes {
                z-index: 4
            }

            #rover {
                z-index: 3
            }

            #ndlt {
                margin: 12px 0
            }

            #roverstar {
                position: fixed;
                top: calc(var(--th) + 5px);
                left: 1px;
                cursor: pointer
            }

            #connind {
                position: fixed;
                bottom: calc(var(--bh) + 5px);
                left: 4px;
                padding: 5px;
                border-radius: 5px;
                background-color: #a90;
                z-index: -2
            }

            #info .slider {
                max-width: 200px;
                min-width: 145px;
                float: right;
                margin: 0
            }

            #info .sliderwrap {
                width: 200px
            }

            #info table,#nodes table {
                table-layout: fixed;
                width: 100%
            }

            #info td,#nodes td {
                padding-bottom: 8px
            }

            #info .btn {
                margin: 5px
            }

            #info table .btn,#nodes table .btn {
                margin: 0
            }

            #info div,#nodes div {
                max-width: 490px;
                margin: 0 auto
            }

            #info #imgw {
                margin: 8px auto
            }

            #lv {
                max-width: 600px;
                display: inline-block
            }

            #heart {
                transition: color .9s;
                font-size: 16px;
                color: red
            }

            img {
                max-width: 100%;
                max-height: 100%
            }

            .wi {
                image-rendering: pixelated;
                image-rendering: crisp-edges;
                width: 210px
            }

            @keyframes fadein {
                from {
                    bottom: 0;
                    opacity: 0
                }

                to {
                    bottom: calc(var(--bh) + 22px);
                    opacity: 1
                }
            }

            .sliderdisplay {
                content: '';
                position: absolute;
                top: 12px;
                left: 8px;
                right: 8px;
                height: 5px;
                background: var(--c-4);
                border-radius: 16px;
                pointer-events: none;
                z-index: -1;
                --bg: var(--c-f)
            }

            #rwrap .sliderdisplay {
                --bg: none;
                background: linear-gradient(90deg,#000 -15%,red)
            }

            #gwrap .sliderdisplay {
                --bg: none;
                background: linear-gradient(90deg,#000 -15%,#0f0)
            }

            #bwrap .sliderdisplay {
                --bg: none;
                background: linear-gradient(90deg,#000 -15%,#00f)
            }

            #wwrap .sliderdisplay {
                --bg: none;
                background: linear-gradient(90deg,#000 -15%,#fff)
            }

            #kwrap .sliderdisplay,#wbal .sliderdisplay {
                background: linear-gradient(90deg,#ff8f1f 0,#fff 50%,#cbdbff)
            }

            #hexw,#hwrap,#kwrap,#liveview,#liveview2D,#pql #rgbwrap,#qcs-w,#roverstar,#swrap,#wbal,#wwrap,.clear-icon,.edit-icon,.ptxt {
                display: none
            }

            .sliderbubble {
                width: 24px;
                position: absolute;
                display: inline-block;
                border-radius: 16px;
                background: var(--c-3);
                color: var(--c-f);
                padding: 4px;
                font-size: 14px;
                right: 6px;
                transition: visibility .25s ease,opacity .25s ease;
                opacity: 0;
                visibility: hidden;
                top: 4px
            }

            output.sliderbubbleshow {
                visibility: visible;
                opacity: 1
            }

            input[type=range] {
                -webkit-appearance: none;
                width: 100%;
                padding: 0;
                margin: 0;
                background-color: transparent;
                cursor: pointer
            }

            input[type=range]:focus {
                outline: 0
            }

            input[type=range]::-webkit-slider-runnable-track {
                width: 100%;
                height: 30px;
                cursor: pointer;
                background: 0 0
            }

            input[type=range]::-webkit-slider-thumb {
                height: 16px;
                width: 16px;
                border-radius: 50%;
                background: var(--c-f);
                cursor: pointer;
                -webkit-appearance: none;
                margin-top: 7px
            }

            input[type=range]::-moz-range-track {
                width: 100%;
                height: 30px;
                background-color: rgba(0,0,0,0)
            }

            input[type=range]::-moz-range-thumb {
                border: 0 solid transparent;
                height: 16px;
                width: 16px;
                border-radius: 50%;
                background: var(--c-f);
                transform: translateY(5px)
            }

            #Colors input[type=range]::-webkit-slider-thumb {
                height: 18px;
                width: 18px;
                border: 2px solid var(--c-1);
                margin-top: 5px
            }

            #Colors input[type=range]::-moz-range-thumb {
                border: 2px solid var(--c-1)
            }

            #Colors .sliderwrap {
                margin: 4px 0 0
            }

            .hd {
                display: var(--bhd)
            }

            #briwrap {
                min-width: 267px;
                float: right;
                margin-top: var(--bmt)
            }

            #picker {
                margin-top: 8px!important;
                max-width: 260px
            }

            .btn {
                padding: 8px;
                margin: 10px 4px;
                width: 230px;
                font-size: 19px;
                color: var(--c-d);
                cursor: pointer;
                border-radius: 25px;
                transition-duration: .3s;
                -webkit-backface-visibility: hidden;
                -webkit-transform: translate3d(0,0,0);
                backface-visibility: hidden;
                transform: translate3d(0,0,0);
                overflow: hidden;
                text-overflow: ellipsis;
                border: 1px solid var(--c-3);
                background-color: var(--c-3)
            }

            #putil .btn-s:hover,#segutil .btn-s:hover,#segutil2 .btn-s:hover,.btn:hover {
                border: 1px solid var(--c-5);
                background-color: var(--c-5)
            }

            .btn-s {
                width: 100%;
                margin: 0
            }

            .btn-icon {
                margin: -4px 4px -1px 0;
                vertical-align: middle;
                display: inline-block
            }

            .btn-n {
                width: 230px;
                margin: 0 8px 0 0
            }

            .btn-p {
                width: 120px;
                margin: 5px 0
            }

            .btn-pl-add,.btn-pl-del,.btn-xs {
                width: 42px!important;
                height: 42px!important;
                text-overflow: clip
            }

            .btn-xs {
                margin: 2px 0 0 0
            }

            #putil .btn-xs {
                margin: 0
            }

            #info .btn-xs {
                border: 1px solid var(--c-4)
            }

            #putil .btn-s {
                width: 135px
            }

            #nodes .infobtn {
                margin: 0
            }

            #putil .btn-s,#segutil .btn-s,#segutil2 .btn-s {
                background-color: var(--c-3);
                border: 1px solid var(--c-3)
            }

            .btn-pl-add,.btn-pl-del {
                margin: 0;
                white-space: nowrap
            }

            #qcs-w {
                margin-top: 10px
            }

            .qcs {
                margin: 2px;
                border-radius: 14px;
                display: inline-block;
                width: 28px;
                height: 28px;
                line-height: 28px
            }

            .qcsb {
                width: 26px;
                height: 26px;
                line-height: 26px;
                border: 1px solid #fff
            }

            #hexw {
                margin-top: 5px
            }

            select {
                padding: 4px 8px;
                margin: 0;
                font-size: 19px;
                background-color: var(--c-3);
                color: var(--c-d);
                cursor: pointer;
                border: 0 solid var(--c-2);
                border-radius: 20px;
                transition-duration: .5s;
                -webkit-backface-visibility: hidden;
                -webkit-transform: translate3d(0,0,0);
                -webkit-appearance: none;
                -moz-appearance: none;
                backface-visibility: hidden;
                transform: translate3d(0,0,0);
                text-overflow: ellipsis
            }

            #tt {
                text-align: center
            }

            .cl {
                background-color: #000
            }

            select.sel-p,select.sel-pl,select.sel-ple {
                margin: 5px 0;
                width: 100%;
                height: 40px
            }

            div.sel-p {
                position: relative
            }

            div.sel-p:after {
                content: "";
                position: absolute;
                right: 10px;
                top: 22px;
                width: 0;
                height: 0;
                border-left: 8px solid transparent;
                border-right: 8px solid transparent;
                border-top: 8px solid var(--c-f)
            }

            select.sel-ple {
                text-align: center
            }

            select.sel-sg {
                margin: 5px 0;
                height: 40px
            }

            option {
                background-color: var(--c-3);
                color: var(--c-f)
            }

            input[type=number],input[type=text] {
                background: var(--c-3);
                color: var(--c-f);
                border: 0 solid var(--c-2);
                border-radius: 10px;
                padding: 8px;
                font-size: 19px;
                transition: background-color .2s;
                outline: 0;
                -webkit-appearance: textfield;
                -moz-appearance: textfield;
                appearance: textfield
            }

            input[type=number] {
                text-align: right;
                width: 50px
            }

            input[type=text] {
                text-align: center
            }

            input[type=number]:focus,input[type=text]:focus {
                background: var(--c-6)
            }

            input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button {
                -webkit-appearance: none
            }

            #hexw input[type=text] {
                width: 6em
            }

            input[type=text].ptxt {
                width: calc(100% - 24px)
            }

            textarea {
                background: var(--c-2);
                color: var(--c-f);
                width: calc(100% - 14px);
                height: 90px;
                border-radius: 5px;
                border: 2px solid var(--c-5);
                outline: 0;
                resize: none;
                font-size: 19px;
                padding: 5px
            }

            .apitxt {
                height: 7em
            }

            ::selection {
                background: var(--c-b)
            }

            .ptxt {
                margin: -1px 4px 8px!important
            }

            .stxt {
                width: 50px!important
            }

            .bname,.pname,.segname {
                white-space: nowrap;
                text-align: center;
                overflow: hidden;
                text-overflow: ellipsis;
                line-height: 24px;
                padding: 8px 24px;
                max-width: 170px;
                position: relative
            }

            .bname {
                padding: 0 24px
            }

            .pname .flr,.segname .flr {
                transform: rotate(0);
                right: -6px
            }

            .sbs {
                display: var(--sgp);
                width: 100%;
                position: relative
            }

            .pname {
                top: 1px
            }

            .plname {
                top: 0
            }

            .pid {
                position: absolute;
                top: 8px;
                left: 12px;
                font-size: 16px;
                text-align: center;
                color: var(--c-b)
            }

            .newseg {
                cursor: default
            }

            .ic {
                padding: 6px 0 0 0
            }

            .xxs {
                width: 44px;
                height: 44px;
                margin: 5px
            }

            .xxs-w {
                margin: 2px;
                width: 50px;
                height: 50px
            }

            #csl .xxs {
                border: 2px solid var(--c-d)!important
            }

            #csl .xxs-w {
                border-width: 5px!important
            }

            #namelabel,.qcs {
                text-shadow: -1px -1px 0 var(--c-1),1px -1px 0 var(--c-1),-1px 1px 0 var(--c-1),1px 1px 0 var(--c-1)
            }

            .psts {
                color: var(--c-f);
                margin: 4px
            }

            .pwr {
                color: var(--c-6);
                cursor: pointer
            }

            .act {
                color: var(--c-f)
            }

            .del {
                position: absolute;
                bottom: 8px;
                right: 8px
            }

            .frz {
                left: 10px;
                position: absolute;
                top: 8px;
                cursor: pointer;
                z-index: 1
            }

            .check,.radio {
                display: block;
                position: relative;
                cursor: pointer
            }

            .revchkl {
                padding: 4px 0 0 35px;
                margin-bottom: 0;
                margin-top: 8px
            }

            TD .revchkl {
                padding: 0 0 0 32px;
                margin-top: 0
            }

            .check input,.radio input {
                position: absolute;
                opacity: 0;
                cursor: pointer;
                height: 0;
                width: 0
            }

            .checkmark,.radiomark {
                position: absolute;
                height: 24px;
                width: 24px;
                top: 0;
                bottom: 0;
                left: 0;
                background-color: var(--c-3);
                border: 1px solid var(--c-2)
            }

            .radiomark {
                top: 8px;
                left: 8px;
                height: 22px;
                width: 22px;
                border-radius: 50%;
                background-color: transparent
            }

            .checkmark {
                border-radius: 10px
            }

            .check:hover input~.checkmark,.radio:hover input~.radiomark {
                background-color: var(--c-5)
            }

            .checkmark:after,.radiomark:after {
                content: "";
                position: absolute;
                display: none
            }

            .check .checkmark:after {
                left: 9px;
                top: 4px;
                width: 5px;
                height: 10px;
                border: solid var(--c-f);
                border-width: 0 3px 3px 0
            }

            .check .checkmark:after,.rot45 {
                -webkit-transform: rotate(45deg);
                -ms-transform: rotate(45deg);
                transform: rotate(45deg)
            }

            .radio .radiomark:after {
                width: 14px;
                height: 14px;
                top: 50%;
                left: 50%;
                margin: -7px;
                border-radius: 50%;
                background: var(--c-f)
            }

            TD .checkmark,TD .radiomark {
                top: -6px
            }

            .h {
                font-size: 13px;
                text-align: center;
                color: var(--c-b)
            }

            .bp {
                margin-bottom: 8px
            }

            .pres,.seg {
                background-color: var(--c-2);
                border: 0 solid var(--c-f);
                text-align: left;
                transition: background-color .5s;
                border-radius: 21px
            }

            .seg {
                top: auto!important;
                bottom: auto!important
            }

            .seg .schkl {
                position: absolute;
                top: 7px;
                left: 9px
            }

            .filter .fchkl,.option .ochkl {
                display: inline-block;
                min-width: .7em;
                padding: 1px 4px 4px 32px;
                text-align: left;
                line-height: 24px;
                vertical-align: middle;
                -webkit-filter: grayscale(100%);
                filter: grayscale(100%)
            }

            .lbl-l {
                font-size: 13px;
                text-align: center;
                padding: 4px 0
            }

            .lbl-s {
                display: inline-block;
                margin-top: 6px;
                font-size: 13px;
                width: 48%;
                text-align: center
            }

            .list {
                position: relative;
                transition: background-color .5s;
                margin: auto auto 10px;
                line-height: 24px
            }

            .lstI {
                align-items: center;
                cursor: pointer;
                background-color: var(--c-2);
                overflow: hidden;
                position: -webkit-sticky;
                position: sticky;
                border-radius: 21px;
                margin: 13px auto 0;
                min-height: 40px;
                border: 1px solid var(--c-2)
            }

            #segutil .lstI {
                margin-top: 0
            }

            .selected {
                background: var(--c-4)
            }

            #segcont .seg:hover:not([class*=expanded]),.lstI:hover:not([class*=expanded]) {
                background: var(--c-5)
            }

            .selected .checkmark,.selected .radiomark,.selected input[type=number],.selected input[type=text] {
                background-color: var(--c-3)
            }

            .lstI.selected {
                top: 0;
                bottom: 0;
                border: 1px solid var(--c-4)
            }

            .lstI.selected,.lstI.sticky {
                z-index: 1;
                box-shadow: 0 0 10px 4px var(--c-1)
            }

            #pcont .selected:not([class*=expanded]) {
                bottom: 52px;
                top: 42px
            }

            #fxlist .lstI.selected {
                top: 84px
            }

            #fxlist .lstI.sticky {
                top: 42px
            }

            #pallist .lstI.selected {
                top: 84px
            }

            #pallist .lstI.sticky {
                top: 42px
            }

            .lstIcontent {
                padding: 9px 0 7px;
                position: relative
            }

            .lstIname {
                white-space: nowrap;
                text-overflow: ellipsis;
                -webkit-filter: grayscale(100%);
                filter: grayscale(100%)
            }

            .lstIprev {
                width: 100%;
                height: 6px;
                position: absolute;
                bottom: 0;
                left: 0;
                z-index: -1
            }

            .fnd {
                position: relative
            }

            .fnd input[type=text] {
                display: block;
                width: 100%;
                box-sizing: border-box;
                padding: 8px 40px 8px 44px;
                margin: 5px auto 0;
                text-align: left;
                border-radius: 21px;
                background: var(--c-2);
                border: 1px solid var(--c-3);
                -webkit-filter: grayscale(100%);
                filter: grayscale(100%)
            }

            .fnd input[type=text]:focus {
                background-color: var(--c-4)
            }

            .fnd input[type=text]:hover,.fnd input[type=text]:not(:placeholder-shown) {
                background-color: var(--c-3)
            }

            .presin,.segin {
                padding: 8px;
                position: relative
            }

            .btn-n,.btn-s {
                border: 1px solid var(--c-2);
                background-color: var(--c-2)
            }

            .modal .btn:hover,.segin .btn:hover {
                border: 1px solid var(--c-5);
                background-color: var(--c-5)
            }

            .pres .lstIcontent,.segin {
                display: none
            }

            .check input:checked~.checkmark:after,.expanded,.expanded .edit-icon,.expanded .presin,.expanded .sbs,.expanded .segin,.radio input:checked~.radiomark:after,.show {
                display: inline-block!important
            }

            .expanded .frz,.expanded .g-icon,.expanded .presin.hide,.expanded .sbs.hide,.expanded .segin.hide,.hide {
                display: none!important
            }

            .m6 {
                margin: 6px 0
            }

            .c {
                text-align: center
            }

            .po2 {
                display: none;
                margin-top: 8px
            }

            .pwarn {
                color: red
            }

            .hrz {
                width: auto;
                height: 2px;
                background-color: var(--c-b);
                margin: 3px 0
            }

            ::-webkit-scrollbar {
                width: 6px
            }

            ::-webkit-scrollbar-track {
                background: 0 0
            }

            ::-webkit-scrollbar-thumb {
                background: var(--c-sb);
                opacity: .2;
                border-radius: 5px
            }

            ::-webkit-scrollbar-thumb:hover {
                background: var(--c-sbh)
            }

            @media not all and (hover: none) {
                .sliderwrap:hover+output.sliderbubble {
                    visibility:visible;
                    opacity: 1
                }
            }

            @media all and (max-width: 1023px) {
                .top button {
                    width:8%;
                    padding: 10px 0 8px 0
                }

                #buttonPcm {
                    display: none
                }
            }

            @media all and (max-width: 335px) {
                .sliderbubble {
                    display:none
                }
            }

            @media all and (max-width: 550px) and (min-width:374px) {
                #info table .btn,#nodes table .btn {
                    width:200px
                }

                #info .infobtn,#nodes .infobtn {
                    width: 145px
                }

                #info div,#nodes div {
                    max-width: 320px
                }
            }

            @media all and (max-width: 420px) {
                #buttonNodes {
                    display:none
                }
            }

            @media all and (max-width: 639px) {
                .top button {
                    width:16.6%;
                    padding: 8px 0 4px 0
                }

                #briwrap {
                    margin: 0 auto!important;
                    float: none;
                    display: inline-block
                }

                .hd {
                    display: none!important
                }
            }

            @media all and (min-width: 420px) and (max-width:639px) {
                .top button {
                    width:14.28%;
                    padding: 8px 0 4px 0
                }
            }

            @media all and (min-width: 640px) and (max-width:767px) {
                #buttonNodes {
                    display:none
                }
            }

            @media all and (min-width: 1024px) and (max-width:1249px) {
                #fx,#palw,#pcont,#pql,#psFind,#putil,#segcont,#segutil,#segutil2,#sliders {
                    width:100%;
                    max-width: 280px;
                    font-size: 18px
                }

                #picker {
                    width: 230px
                }

                #putil .btn-s {
                    width: 114px
                }

                #sliders .sliderbubble {
                    display: none
                }

                #sliders .sliderwrap,.sbs .sliderwrap {
                    width: calc(100% - 42px)
                }

                #sliders .slider {
                    padding-right: 0
                }

                #sliders .sliderwrap {
                    left: 12px
                }

                .segname {
                    max-width: calc(100% - 110px)
                }

                .segt TD {
                    padding: 0!important
                }

                input[type=number],input[type=text],select,textarea {
                    font-size: 18px
                }

                input[type=number] {
                    width: 32px
                }

                .lstIcontent {
                    padding-left: 8px
                }

                .revchkl {
                    max-width: 183px;
                    text-overflow: ellipsis;
                    overflow-x: clip
                }
            }
        </style>
    </head>
    <body>
        <div id="cv" class="overlay">Loading DUNEWEAVER UI...</div>
        <noscript>
            <div class="overlay" style="opacity:1">Sorry, DUNEWEAVER UI needs JavaScript!</div>
        </noscript>
        <div id="bg"></div>
        <div class="wrapper" id="top">
            <div class="tab top">
                <div class="btnwrap">
                    <button id="buttonPower" onclick="togglePower()" class="tgl">
                        <i class="icons">&#xe08f;</i>
                        <p class="tab-label">Power</p>
                    </button>
                   <!--- kmo <button id="buttonNl" onclick="toggleNl()">
                        <i class="icons">&#xe2a2;</i>
                        <p class="tab-label">Timer</p>
                    <button id="buttonSync" onclick="toggleSync()">
                        <i class="icons">&#xe116;</i>
                        <p class="tab-label">Sync</p>
                    </button>
                    <button id="buttonSr" onclick="toggleLiveview()">
                        <i class="icons">&#xe410;</i>
                        <p class="tab-label">Peek</p>-->
                    </button>
                    <button id="buttonI" onclick="toggleInfo()">
                        <i class="icons">&#xe066;</i>
                        <p class="tab-label">Info</p>
                    </button>
                    <button id="buttonNodes" onclick="toggleNodes()">
                        <i class="icons">&#xe22d;</i>
                        <p class="tab-label">Nodes</p>
</p>
                    </button>
                    <button onclick='window.location.href=getURL("/settings")'>
                        <i class="icons">&#xe0a2;</i>
                        <p class="tab-label">Config</p>
                    </button>
                    <button id="buttonPcm" onclick="togglePcMode(!0)">
                        <i class="icons">&#xe23d;</i>
                        <p class="tab-label">PC Mode</p>
                    </button>
                </div>
                <div id="briwrap">
                    <p class="hd">Brightness</p>
                    <div class="slider" style="padding-right:32px">
                        <i class="icons slider-icon" onclick="tglTheme()" style="transform:translate(-32px,5px)">&#xe2a6;</i>
                        <div class="sliderwrap il">
                            <input id="sliderBri" onchange="setBri()" oninput="updateTrail(this)" max="255" min="1" type="range" value="128">
                            <div class="sliderdisplay"></div>
                        </div>
                        <output class="sliderbubble"></output>
                    </div>
                </div>
                <iframe id="liveview" src="about:blank"></iframe>
            </div>
        </div>
        <div class="container">
            <div id="Colors" class="tabcontent">
                <div id="picker" class="noslide"></div>
                <div id="hwrap" class="slider" style="margin-top:20px">
                    <div class="sliderwrap il">
                        <input id="sliderH" class="noslide" oninput="fromH()" onchange="setColor(0)" max="359" min="0" type="range" value="0" step="any">
                        <div class="sliderdisplay" style="background:linear-gradient(90deg,red 2%,#ff0 19%,#0f0 35%,#0ff 52%,#00f 68%,#f0f 85%,red)"></div>
                    </div>
                    <span class="tooltiptext">Hue</span>
                </div>
                <div id="swrap" class="slider">
                    <div class="sliderwrap il">
                        <input id="sliderS" class="noslide" oninput="fromS()" onchange="setColor(0)" max="100" min="0" type="range" value="100" step="any">
                        <div class="sliderdisplay" style="background:linear-gradient(90deg,#aaa 0,red)"></div>
                    </div>
                    <span class="tooltiptext">Saturation</span>
                </div>
                <div id="vwrap" class="slider">
                    <div class="sliderwrap il">
                        <input id="sliderV" class="noslide" oninput="fromV()" onchange="setColor(0)" max="100" min="0" type="range" value="100" step="any">
                        <div class="sliderdisplay"></div>
                    </div>
                    <span class="tooltiptext">Value/Brightness</span>
                </div>
                <div id="kwrap" class="slider">
                    <div class="sliderwrap il">
                        <input id="sliderK" class="noslide" oninput="fromK()" onchange="setColor(0)" max="10091" min="1900" type="range" value="6550">
                        <div class="sliderdisplay"></div>
                    </div>
                    <span class="tooltiptext">Kelvin/Temperature</span>
                </div>
                <div id="rgbwrap">
                    <div id="rwrap" class="slider">
                        <div class="sliderwrap il">
                            <input id="sliderR" class="noslide" oninput="fromRgb()" onchange="setColor(0)" max="255" min="0" type="range" value="128">
                            <div class="sliderdisplay"></div>
                        </div>
                        <span class="tooltiptext">Red channel</span>
                    </div>
                    <div id="gwrap" class="slider">
                        <div class="sliderwrap il">
                            <input id="sliderG" class="noslide" oninput="fromRgb()" onchange="setColor(0)" max="255" min="0" type="range" value="128">
                            <div class="sliderdisplay"></div>
                        </div>
                        <span class="tooltiptext">Green channel</span>
                    </div>
                    <div id="bwrap" class="slider">
                        <div class="sliderwrap il">
                            <input id="sliderB" class="noslide" oninput="fromRgb()" onchange="setColor(0)" max="255" min="0" type="range" value="128">
                            <div class="sliderdisplay"></div>
                        </div>
                        <span class="tooltiptext">Blue channel
</span>
                    </div>
                </div>
                <div id="wwrap" class="slider">
                    <div id="whibri" class="sliderwrap il">
                        <input id="sliderW" class="noslide" oninput="fromW()" onchange="setColor(0)" max="255" min="0" type="range" value="128">
                        <div class="sliderdisplay"></div>
                    </div>
                    <span class="tooltiptext">White channel
</span>
                </div>
                <div id="wbal" class="slider">
                    <div class="sliderwrap il">
                        <input id="sliderA" class="noslide" onchange="setBalance(this.value)" max="255" min="0" type="range" value="128">
                        <div class="sliderdisplay"></div>
                    </div>
                    <span class="tooltiptext">White balance</span>
                </div>
                <div id="qcs-w">
                    <div class="qcs" onclick='pC("#ff0000")' title="Red" style="background-color:red"></div>
                    <div class="qcs" onclick='pC("#ffa000")' title="Orange" style="background-color:#ffa000"></div>
                    <div class="qcs" onclick='pC("#ffc800")' title="Yellow" style="background-color:#ffc800"></div>
                    <div class="qcs" onclick='pC("#ffe0a0")' title="Warm White" style="background-color:#ffe0a0"></div>
                    <div class="qcs" onclick='pC("#ffffff")' title="White" style="background-color:#fff"></div>
                    <div class="qcs qcsb" onclick='pC("#000000")' title="Black" style="background-color:#000"></div>
                    <br>
                    <div class="qcs" onclick='pC("#ff00ff")' title="Pink" style="background-color:#f0f"></div>
                    <div class="qcs" onclick='pC("#0000ff")' title="Blue" style="background-color:#00f"></div>
                    <div class="qcs" onclick='pC("#00ffc8")' title="Cyan" style="background-color:#00ffc8"></div>
                    <div class="qcs" onclick='pC("#08ff00")' title="Green" style="background-color:#08ff00"></div>
                    <div class="qcs" onclick='pC("rnd")' title="Random" style="background:linear-gradient(to right,red,orange,#ff0,green,#00f,purple);transform:translateY(-11px)">R</div>
                </div>
                <div id="csl">
                    <button id="csl0" class="btn xxs cl" onclick="selectSlot(0)" data-r="0" data-g="0" data-b="0" data-w="0">1</button>
                    <button id="csl1" class="btn xxs cl" onclick="selectSlot(1)" data-r="0" data-g="0" data-b="0" data-w="0">2</button>
                    <button id="csl2" class="btn xxs cl" onclick="selectSlot(2)" data-r="0" data-g="0" data-b="0" data-w="0">3</button>
                </div>
                <p class="labels h" id="cslLabel"></p>
                <div id="hexw">
                    <i class="icons sel-icon" onclick="tglRgb()">&#xe22d;</i>
                    <input id="hexc" type="text" class="noslide" onkeydown="hexEnter()" autocomplete="off" maxlength="8">
                    <button id="hexcnf" class="btn btn-xs" onclick="fromHex()">
                        <i class="icons btn-icon">&#xe390;</i>
                    </button>
                </div>
                <p class="labels" id="pall">
                    <i class="icons sel-icon" onclick="tglHex()">&#xe2b3;</i>
                    Color palette
                </p>
                <div id="palw" class="il">
                    <div class="staytop fnd">
                        <input type="text" placeholder="Search" oninput='search(this,"pallist")' onfocus='search(this,"pallist")'>
                        <i class="icons clear-icon" onclick="clean(this)">&#xe38f;</i>
                        <i class="icons search-icon">&#xe0a1;</i>
                    </div>
                    <div id="pallist" class="list">
                        <div class="lstI">
                            <label class="radio schkl" onclick="loadPalettes()">
                                <div class="lstIcontent">
                                    <span class="lstIname">Loading... </span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                <div style="padding-block:10px">
                    <button class="btn btn-xs" type="button" onclick='window.location.href=getURL("/pxmagic.htm")'>
                        <i class="icons btn-icon">&#xe410;</i>
                    </button>
                    <button class="btn btn-xs" type="button" onclick='window.location.href=getURL("/cpal.htm")'>
                        <i class="icons btn-icon">&#xe18a;</i>
                    </button>
                    <button class="btn btn-xs" type="button" onclick='palettesData=null,localStorage.removeItem("wledPalx"),requestJson({rmcpal:!0}),setTimeout(loadPalettes,250,loadPalettesData)'>
                        <i class="icons btn-icon">&#xe037;</i>
                    </button>
                </div>
            </div>
            <div id="Effects" class="tabcontent">
                <div id="fx">
                    <p class="labels hd" id="modeLabel">Effect mode</p>
                    <div class="staytop fnd" id="fxFind">
                        <input type="text" placeholder="Search" oninput='search(this,"fxlist")' onfocus='search(this,"fxlist"),gId("filters").classList.add("fade")' onblur='gId("filters").classList.remove("fade")'>
                        <i class="icons clear-icon" onclick="clean(this)">&#xe38f;</i>
                        <i class="icons search-icon" onclick='gId("filters").classList.toggle("hide")' style="cursor:pointer">&#xe0a1;</i>
                    </div>
                    <div id="fxlist" class="list">
                        <div class="lstI">
                            <label class="radio schkl" onclick="loadFX()">
                                <div class="lstIcontent">
                                    <span class="lstIname">Loading... </span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                <div id="sliders">
                    <div id="filters" class="filter">
                        <label id="filterPal" class="check fchkl">
                            &#x1F3A8;<input type="checkbox" data-flt="&#x1F3A8;" onchange="filterFx(this)">
                            <span class="checkmark"></span>
                        </label>
                        <label id="filter0D" class="check fchkl hide">
                            &#8226;<input type="checkbox" data-flt="&#8226;" onchange="filterFx(this)">
                            <span class="checkmark"></span>
                        </label>
                        <label id="filter1D" class="check fchkl">
                            &#8942;<input type="checkbox" data-flt="&#8942;" onchange="filterFx(this)">
                            <span class="checkmark"></span>
                        </label>
                        <label id="filter2D" class="check fchkl">
                            &#9638;<input type="checkbox" data-flt="&#9638;" onchange="filterFx(this)">
                            <span class="checkmark"></span>
                        </label>
                        <label id="filterVol" class="check fchkl">
                            &#9834;<input type="checkbox" data-flt="&#9834;" onchange="filterFx(this)">
                            <span class="checkmark"></span>
                        </label>
                        <label id="filterFreq" class="check fchkl">
                            &#9835;<input type="checkbox" data-flt="&#9835;" onchange="filterFx(this)">
                            <span class="checkmark"></span>
                        </label>
                    </div>
                    <div id="slider0" class="slider">
                        <i class="icons slider-icon" onclick="tglFreeze()">&#xe325;</i>
                        <div class="sliderwrap il">
                            <input id="sliderSpeed" class="noslide" onchange="setSpeed()" oninput="updateTrail(this)" max="255" min="0" type="range" value="128">
                            <div class="sliderdisplay"></div>
                        </div>
                        <output class="sliderbubble"></output>
                        <span id="sliderLabel0" class="tooltiptext">Effect speed</span>
                    </div>
                    <div id="slider1" class="slider">
                        <i class="icons slider-icon" onclick="tglLabels()">&#xe409;</i>
                        <div class="sliderwrap il">
                            <input id="sliderIntensity" class="noslide" onchange="setIntensity()" oninput="updateTrail(this)" max="255" min="0" type="range" value="128">
                            <div class="sliderdisplay"></div>
                        </div>
                        <output class="sliderbubble"></output>
                        <span class="tooltiptext" id="sliderLabel1">Effect intensity</span>
                    </div>
                    <div id="slider2" class="slider hide">
                        <i class="icons slider-icon">&#xe410;</i>
                        <div class="sliderwrap il">
                            <input id="sliderC1" class="noslide" onchange="setCustom(1)" oninput="updateTrail(this)" max="255" min="0" type="range" value="0">
                            <div class="sliderdisplay"></div>
                        </div>
                        <output class="sliderbubble"></output>
                        <span class="tooltiptext" id="sliderLabel2">Custom 1</span>
                    </div>
                    <div id="slider3" class="slider hide">
                        <i class="icons slider-icon">&#xe0a2;</i>
                        <div class="sliderwrap il">
                            <input id="sliderC2" class="noslide" onchange="setCustom(2)" oninput="updateTrail(this)" max="255" min="0" type="range" value="0">
                            <div class="sliderdisplay"></div>
                        </div>
                        <output class="sliderbubble"></output>
                        <span class="tooltiptext" id="sliderLabel3">Custom 2</span>
                    </div>
                    <div id="slider4" class="slider hide">
                        <i class="icons slider-icon">&#xe0e8;</i>
                        <div class="sliderwrap il">
                            <input id="sliderC3" class="noslide" onchange="setCustom(3)" oninput="updateTrail(this)" max="31" min="0" type="range" value="0">
                            <div class="sliderdisplay"></div>
                        </div>
                        <output class="sliderbubble"></output>
                        <span class="tooltiptext" id="sliderLabel4">Custom 3</span>
                    </div>
                    <div id="fxopt" class="option fade">
                        <label id="opt0" class="check ochkl hide">
                            <i class="icons">&#xe2b3;</i>
                            <span class="tooltiptext" id="optLabel0">Check 1</span>
                            <input id="checkO1" type="checkbox" onchange="setOption(1,this.checked)">
                            <span class="checkmark"></span>
                        </label>
                        <label id="opt1" class="check ochkl hide">
                            <i class="icons">&#xe34b;</i>
                            <span class="tooltiptext" id="optLabel1">Check 2</span>
                            <input id="checkO2" type="checkbox" onchange="setOption(2,this.checked)">
                            <span class="checkmark"></span>
                        </label>
                        <label id="opt2" class="check ochkl hide">
                            <i class="icons">&#xe04c;</i>
                            <span class="tooltiptext" id="optLabel2">Check 3</span>
                            <input id="checkO3" type="checkbox" onchange="setOption(3,this.checked)">
                            <span class="checkmark"></span>
                        </label>
                    </div>
                </div>
            </div>
        
            <div id="Segments" style="display: none;" class="tabcontent">
                <div id="segcont">Loading... </div>
                <div id="segutil" class="staybot"></div>
                <div id="segutil2">
                    <button class="btn btn-s" id="rsbtn" onclick="rSegs()">Reset segments</button>
                </div>
                <p>
                    Transition: 
<input id="tt" type="number" min="0" max="65.5" step="0.1" value="0.7">&nbsp;s

                </p>
                <p id="ledmap" class="hide"></p>
            </div>
            <div id="Presets" class="tabcontent">
                <div id="pql"></div>
                <p class="labels hd">Presets</p>
                <div class="staytop fnd" id="psFind">
                    <input type="text" placeholder="Search" oninput='search(this,"pcont")' onfocus='search(this,"pcont")'>
                    <i class="icons clear-icon" onclick="clean(this)">&#xe38f;</i>
                    <i class="icons search-icon">&#xe0a1;</i>
                </div>
                <div id="pcont" class="list">
                    <span onclick="loadPresets()">Loading...</span>
                </div>
                <div id="putil" class="staybot"></div>
            </div>
        </div>
        <div class="tab bot" id="bot">
            <button class="tablinks" onclick="openTab(0)">
                <i class="icons">&#xe2b3;</i>
                <p class="tab-label">Colors</p>
            </button>
            <button class="tablinks" onclick="openTab(1)">
                <i class="icons">&#xe23d;</i>
                <p class="tab-label">Effects
</p>
            </button>
            <button class="tablinks" onclick="openTab(2)">
                <i class="icons">&#xe34b;</i>
                <p class="tab-label">Segments</p>
            </button>
            <button class="tablinks" onclick="openTab(3)">
                <i class="icons">&#xe04c;</i>
                <p class="tab-label">Presets
</p>
            </button>
        </div>
        <div id="connind"></div>
        <div id="toast" onclick="clearErrorToast(100)"></div>
        <div id="namelabel" onclick="toggleNodes()"></div>
        <div id="info" class="modal">
            <button class="btn btn-xs close" onclick="toggleInfo()">
                <i class="icons rot45">&#xe18a;</i>
            </button>
            <div id="imgw">
                <img class="wi" alt src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAFCAYAAAC5Fuf5AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAABbSURBVChTlY9bDoAwDMNW7n9nwCipytQN4Z8tbrTHmDmF4oPzyldwRqp1SSdnV/NuZuzqerAByxXznBw3igkeFEfXyUuhK/yFM0CxJfyqXZEOc6/Sr9/bf7uIC5Nwd7orMvAPAAAAAElFTkSuQmCC">
            </div>
            <div id="kv">Loading...</div>
            <br>
            <div>
                <button class="btn infobtn" onclick="requestJson()">Refresh</button>
                <button class="btn infobtn" onclick="toggleNodes()">Instance List</button>
                <button class="btn infobtn" onclick='window.open(getURL("/update"),"_self")'>Update DUNEWEAVER</button>
                <button class="btn infobtn" id="resetbtn" onclick="cnfReset()">Reboot DUNEWEAVER WLED</button>
            </div>
            <br>
            <span class="h">
                Made with <span id="heart">&#10084;&#xFE0E;</span>
                by Aircoookie and the <a href="https://wled.discourse.group/" target="_blank">WLED community</a>
            </span>
        </div>
        <div id="nodes" class="modal">
            <button class="btn btn-xs close" onclick="toggleNodes()">
                <i class="icons rot45">&#xe18a;</i>
            </button>
            <div id="ndlt">WLED instances</div>
            <div id="kn">Loading...</div>
            <div style="position:sticky;bottom:0">
                <button class="btn infobtn" onclick="loadNodes()">Refresh</button>
            </div>
        </div>
        <div id="mlv2D" class="modal">
            <div id="klv2D" style="width:100%;height:100%">Loading...</div>
        </div>
        <div id="rover" class="modal">
            <i class="icons huge">&#xe410;</i>
            <br>
            <div id="lv">?</div>
            <br>
            <br>
            To use built-in effects, use an override button below.<br>
            You can return to realtime mode by pressing the star in the top left corner.
<br>
            <button class="btn" onclick="setLor(1)">Override once</button>
            <button class="btn" onclick="setLor(2)">Override until reboot</button>
            <br>
            <span class="h">For best performance, it is recommended to turn off the streaming source when not in use.
</span>
        </div>
        <i id="roverstar" class="icons huge" onclick="setLor(0)">&#xe410;</i>
        <br>
        <script>
            var locip, wW, palettesData, ws, cpick, ranges, timeout, loc = !1, locproto = "http:", isOn = !1, nlA = !1, isLv = !1, isInfo = !1, isNodes = !1, syncSend = !1, syncTglRecv = !0, hasWhite = !1, hasRGB = !1, hasCCT = !1, nlDur = 60, nlTar = 0, nlMode = !1, segLmax = 0, selectedFx = 0, selectedPal = 0, csel = 0, currentPreset = -1, lastUpdate = 0, segCount = 0, ledCount = 0, lowestUnused = 0, maxSeg = 0, lSeg = 0, pcMode = !1, pcModeA = !1, lastw = 0, tr = 7, d = document, fxdata = [], pJson = {}, eJson = {}, lJson = {}, plJson = {}, pN = "", pI = 0, pNum = 0, pmt = 1, pmtLS = 0, pmtLast = 0, lastinfo = {}, isM = !1, mw = 0, mh = 0, wsRpt = 0, cfg = {
                theme: {
                    base: "dark",
                    bg: {
                        url: ""
                    },
                    alpha: {
                        bg: .6,
                        tab: .8
                    },
                    color: {
                        bg: ""
                    }
                },
                comp: {
                    colors: {
                        picker: !0,
                        rgb: !1,
                        quick: !0,
                        hex: !1
                    },
                    labels: !0,
                    pcmbot: !1,
                    pid: !0,
                    seglen: !1,
                    segpwr: !1,
                    segexp: !1,
                    css: !0,
                    hdays: !1,
                    fxdef: !0,
                    idsort: !1
                }
            }, hol = [[0, 11, 24, 4, "https://aircoookie.github.io/xmas.png"], [0, 2, 17, 1, "https://images.alphacoders.com/491/491123.jpg"], [2025, 3, 20, 2, "https://aircoookie.github.io/easter.png"], [2024, 2, 31, 2, "https://aircoookie.github.io/easter.png"], [0, 6, 4, 1, "https://images.alphacoders.com/516/516792.jpg"], [0, 0, 1, 1, "https://images.alphacoders.com/119/1198800.jpg"]];
            function handleVisibilityChange() {
                !d.hidden && new Date - lastUpdate > 3e3 && requestJson()
            }
            function sCol(e, t) {
                d.documentElement.style.setProperty(e, t)
            }
            function gId(e) {
                return d.getElementById(e)
            }
            function gEBCN(e) {
                return d.getElementsByClassName(e)
            }
            function isEmpty(e) {
                return 0 === Object.keys(e).length
            }
            function isObj(e) {
                return e && "object" == typeof e && !Array.isArray(e)
            }
            function isNumeric(e) {
                return !isNaN(parseFloat(e)) && isFinite(e)
            }
            function isRgbBlack(e) {
                return 0 == parseInt(e.r) && 0 == parseInt(e.g) && 0 == parseInt(e.b)
            }
            function rgbStr(e) {
                return "rgb(" + e.r + "," + e.g + "," + e.b + ")"
            }
            function rgbBri(e) {
                return .2126 * parseInt(e.r) + .7152 * parseInt(e.g) + .0722 * parseInt(e.b)
            }
            function setCSL(e) {
                let t = e.dataset.w ? parseInt(e.dataset.w) : 0
                  , s = "none" !== getComputedStyle(e).textShadow;
                hasRGB && !isRgbBlack(e.dataset) ? (s || (e.style.color = rgbBri(e.dataset) > 127 ? "#000" : "#fff"),
                e.style.background = hasWhite && t > 0 ? `linear-gradient(180deg, ${rgbStr(e.dataset)} 30%, rgb(${t},${t},${t}))` : rgbStr(e.dataset)) : (hasRGB && !hasWhite && (t = 0),
                e.style.background = `rgb(${t},${t},${t})`,
                s || (e.style.color = t > 127 ? "#000" : "#fff"))
            }
            function applyCfg() {
                cTheme("light" === cfg.theme.base);
                var e = cfg.theme.color.bg;
                e && sCol("--c-1", e);
                var t = cfg.comp.labels;
                sCol("--tbp", t ? "14px 14px 10px 14px" : "10px 22px 4px 22px"),
                sCol("--bbp", t ? "9px 0 7px 0" : "10px 0 4px 0"),
                sCol("--bhd", t ? "block" : "none"),
                sCol("--bmt", t ? "0px" : "5px"),
                sCol("--t-b", cfg.theme.alpha.tab),
                sCol("--sgp", cfg.comp.segpwr ? "none" : "block"),
                size(),
                localStorage.setItem("wledUiCfg", JSON.stringify(cfg)), updateUI()
               
                //kmo lastinfo.leds && updateUI()
            }
            function tglHex() {
                cfg.comp.colors.hex = !cfg.comp.colors.hex,
                applyCfg()
            }
            function tglTheme() {
                cfg.theme.base = "light" === cfg.theme.base ? "dark" : "light",
                applyCfg()
            }
            function tglLabels() {
                cfg.comp.labels = !cfg.comp.labels,
                applyCfg()
            }
            function tglRgb() {
                cfg.comp.colors.rgb = !cfg.comp.colors.rgb,
                applyCfg()
            }
            function cTheme(e) {
                e ? (sCol("--c-1", "#eee"),
                sCol("--c-f", "#000"),
                sCol("--c-2", "#ddd"),
                sCol("--c-3", "#bbb"),
                sCol("--c-4", "#aaa"),
                sCol("--c-5", "#999"),
                sCol("--c-6", "#999"),
                sCol("--c-8", "#888"),
                sCol("--c-b", "#444"),
                sCol("--c-c", "#333"),
                sCol("--c-e", "#111"),
                sCol("--c-d", "#222"),
                sCol("--c-r", "#a21"),
                sCol("--c-g", "#2a1"),
                sCol("--c-l", "#26c"),
                sCol("--c-o", "rgba(204, 204, 204, 0.9)"),
                sCol("--c-sb", "#0003"),
                sCol("--c-sbh", "#0006"),
                sCol("--c-tb", "rgba(204, 204, 204, var(--t-b))"),
                sCol("--c-tba", "rgba(170, 170, 170, var(--t-b))"),
                sCol("--c-tbh", "rgba(204, 204, 204, var(--t-b))"),
                gId("imgw").style.filter = "invert(0.8)") : (sCol("--c-1", "#111"),
                sCol("--c-f", "#fff"),
                sCol("--c-2", "#222"),
                sCol("--c-3", "#333"),
                sCol("--c-4", "#444"),
                sCol("--c-5", "#555"),
                sCol("--c-6", "#666"),
                sCol("--c-8", "#888"),
                sCol("--c-b", "#bbb"),
                sCol("--c-c", "#ccc"),
                sCol("--c-e", "#eee"),
                sCol("--c-d", "#ddd"),
                sCol("--c-r", "#e42"),
                sCol("--c-g", "#4e2"),
                sCol("--c-l", "#48a"),
                sCol("--c-o", "rgba(34, 34, 34, 0.9)"),
                sCol("--c-sb", "#fff3"),
                sCol("--c-sbh", "#fff5"),
                sCol("--c-tb", "rgba(34, 34, 34, var(--t-b))"),
                sCol("--c-tba", "rgba(102, 102, 102, var(--t-b))"),
                sCol("--c-tbh", "rgba(51, 51, 51, var(--t-b))"),
                gId("imgw").style.filter = "unset")
            }
            function loadBg(e) {
                let t = gId("bg")
                  , s = d.createElement("img");
                if (s.src = e,
                "" == e || "https://picsum.photos/1920/1080" === e) {
                    var n = new Date;
                    for (var l of hol || []) {
                        var a = 0 == l[0] ? n.getFullYear() : l[0]
                          , o = new Date(a,l[1],l[2])
                          , i = new Date(o);
                        i.setDate(i.getDate() + l[3]),
                        n >= o && n <= i && (s.src = l[4])
                    }
                }
                s.addEventListener("load", e => {
                    var n = parseFloat(cfg.theme.alpha.bg);
                    isNaN(n) && (n = .6),
                    t.style.opacity = n,
                    t.style.backgroundImage = `url(${s.src})`,
                    s = null,
                    gId("namelabel").style.color = "var(--c-c)"
                }
                )
            }
            function loadSkinCSS(e) {
                if (!gId(e)) {
                    var t = d.getElementsByTagName("head")[0]
                      , s = d.createElement("link");
                    s.id = e,
                    s.rel = "stylesheet",
                    s.type = "text/css",
                    s.href = getURL("/skin.css"),
                    s.media = "all",
                    t.appendChild(s)
                }
            }
            function getURL(e) {
                return (loc ? locproto + "//" + locip : "") + e
            }
            function onLoad() {
                let e = window.location;
                if ("file:" == e.protocol)
                    loc = !0,
                    (locip = localStorage.getItem("locIp")) || (locip = prompt("File Mode. Please enter WLED IP!"),
                    localStorage.setItem("locIp", locip));
                else {
                    let t = e.pathname
                      , s = t.slice(1, t.endsWith("/") ? -1 : void 0).split("/");
                    locproto = e.protocol,
                    locip = e.hostname + (e.port ? ":" + e.port : ""),
                    s.length > 0 && "" !== s[0] ? (loc = !0,
                    locip += "/" + s[0]) : "https:" === locproto && (loc = !0)
                }
                var t = localStorage.getItem("wledUiCfg");
                t && (cfg = mergeDeep(cfg, JSON.parse(t))),
                resetPUtil(),
                ("true" == localStorage.getItem("pcm") || !/Mobi/.test(navigator.userAgent) && null == localStorage.getItem("pcm")) && togglePcMode(!0),
                applyCfg(),
                cfg.comp.hdays ? fetch(getURL("/holidays.json"), {
                    method: "get"
                }).then(e => e.json()).then(e => {
                    Array.isArray(e) && (hol = e)
                }
                ).catch(e => {
                    console.log("No array of holidays in holidays.json. Defaults loaded.")
                }
                ).finally( () => {
                    loadBg(cfg.theme.bg.url)
                }
                ) : loadBg(cfg.theme.bg.url),
                cfg.comp.css && loadSkinCSS("skinCss"),
                selectSlot(0),
                updateTablinks(0),
                pmtLS = localStorage.getItem("wledPmt"),
                loadPalettes( () => {
                    loadFXData( () => {
                        loadFX( () => {
                            setTimeout( () => {
                                loadPalettesData( () => {
                                    requestJson()
                                }
                                )
                            }
                            , 100)
                        }
                        )
                    }
                    )
                }
                ),
                resetUtil(),
                d.addEventListener("visibilitychange", handleVisibilityChange, !1),
                gId("cv").style.opacity = 0;
                var s = d.querySelectorAll('input[type="range"]');
                for (var n of s)
                    n.addEventListener("touchstart", toggleBubble),
                    n.addEventListener("touchend", toggleBubble)
            }
            function updateTablinks(e) {
                var t = gEBCN("tablinks");
                for (var s of t)
                    s.classList.remove("active");
                pcMode || t[e].classList.add("active")
            }
            function openTab(e, t=!1) {
                pcMode && !t || (iSlide = e,
                _C.classList.toggle("smooth", !1),
                _C.style.setProperty("--i", iSlide),
                updateTablinks(e))
            }
            function showToast(e, t=!1) {
                t && (gId("connind").style.backgroundColor = "var(--c-r)");
                var s = gId("toast");
                s.innerHTML = e,
                s.classList.add(t ? "error" : "show"),
                clearTimeout(timeout),
                s.style.animation = "none",
                timeout = setTimeout( () => {
                    s.classList.remove("show")
                }
                , 2900),
                t && console.log(e)
            }
            function showErrorToast() {
                showToast("Connection to light failed!", !0)
            }
            function clearErrorToast(e=5e3) {
                var t = gId("toast");
                t.classList.contains("error") && (clearTimeout(timeout),
                timeout = setTimeout( () => {
                    t.classList.remove("show"),
                    t.classList.remove("error")
                }
                , e))
            }
            function getRuntimeStr(e) {
                var t = parseInt(e)
                  , s = Math.floor(t / 86400)
                  , n = Math.floor((t - 86400 * s) / 3600)
                  , l = Math.floor((t - 86400 * s - 3600 * n) / 60)
                  , a = s ? s + " " + (1 == s ? "day" : "days") + ", " : "";
                return a += n || s ? n + " " + (1 == n ? "hour" : "hours") : "",
                !s && n && (a += ", "),
                t > 59 && !s && (a += l + " min"),
                t < 3600 && t > 59 && (a += ", "),
                t < 3600 && (a += t - 60 * l + " sec"),
                a
            }
            function inforow(e, t, s="") {
                return `<tr><td class="keytd">${e}</td><td class="valtd">${t}${s}</td></tr>`
            }
            function getLowestUnusedP() {
                var e = 1;
                for (var t in pJson)
                    t == e && e++;
                return e > 250 && (e = 250),
                e
            }
            function checkUsed(e) {
                var t = gId(`p${e}id`).value;
                !pJson[t] || 0 != e && t == e ? gId(`p${e}warn`).innerHTML = t > 250 ? "&#9888; ID must be 250 or less." : "" : gId(`p${e}warn`).innerHTML = `&#9888; Overwriting ${pName(t)}!`
            }
            function pName(e) {
                var t = "Preset " + e;
                return pJson && pJson[e] && pJson[e].n && (t = pJson[e].n),
                t
            }
            function isPlaylist(e) {
                return pJson[e].playlist && pJson[e].playlist.ps
            }
            function papiVal(e) {
                if (!pJson || !pJson[e])
                    return "";
                var t = Object.assign({}, pJson[e]);
                return t.win ? t.win : (delete t.n,
                delete t.p,
                delete t.ql,
                JSON.stringify(t))
            }
            function qlName(e) {
                return pJson && pJson[e] && pJson[e].ql ? pJson[e].ql : ""
            }
            function cpBck() {
                var e = gId("bck");
                e.select(),
                e.setSelectionRange(0, 999999),
                d.execCommand("copy"),
                showToast("Copied to clipboard!")
            }
            function presetError(e) {
                var t = !1
                  , s = "";
                try {
                    (s = localStorage.getItem("wledP")).length > 10 && (t = !0)
                } catch (e) {}
                var n = `<div class="pres c" ${e ? 'style="padding:8px;margin-top: 16px;"' : 'onclick="pmtLast=0;loadPresets();" style="cursor:pointer;padding:8px;margin-top: 16px;"'}>`;
                n += e ? "You have no presets yet!" : "Sorry, there was an issue loading your presets!",
                t && (n += "<br><br>",
                n += e ? "However, there is backup preset data of a previous installation available.<br>\n   (Saving a preset will hide this and overwrite the backup)" : "Here is a backup of the last known good state:",
                n += '<textarea id="bck"></textarea><br>\n   <button class="btn" onclick="cpBck()">Copy to clipboard</button>'),
                n += "</div>",
                gId("pcont").innerHTML = n,
                t && (gId("bck").value = s)
            }
            function loadPresets(e=null) {
                if (e && pmt == pmtLS && pmt > 0)
                    return populatePresets(!0),
                    pmtLast = pmt,
                    void e();
                (e || pmt != pmtLast) && fetch(getURL("/presets.json"), {
                    method: "get"
                }).then(e => "404" == e.status ? {
                    0: {}
                } : e.json()).then(e => {
                    pJson = e,
                    pmtLast = pmt,
                    populatePresets()
                }
                ).catch(e => {
                    presetError(!1)
                }
                ).finally( () => {
                    e && setTimeout(e, 99)
                }
                )
            }
            function loadPalettes(e=null) {
                fetch(getURL("/json/palettes"), {
                    method: "get"
                }).then(e => (e.ok || showErrorToast(),
                e.json())).then(e => {
                    lJson = Object.entries(e),
                    populatePalettes()
                }
                ).catch(e => {
                    showToast(e, !0)
                }
                ).finally( () => {
                    e && e(),
                    updateUI()
                }
                )
            }
            function loadFX(e=null) {
                fetch(getURL("/json/effects"), {
                    method: "get"
                }).then(e => (e.ok || showErrorToast(),
                e.json())).then(e => {
                    eJson = Object.entries(e),
                    populateEffects()
                }
                ).catch(e => {
                    showToast(e, !0)
                }
                ).finally( () => {
                    e && e(),
                    updateUI()
                }
                )
            }
            function loadFXData(e=null) {
                fetch(getURL("/json/fxdata"), {
                    method: "get"
                }).then(e => (e.ok || showErrorToast(),
                e.json())).then(e => {
                    (fxdata = e || []).shift(),
                    fxdata.unshift(";!;")
                }
                ).catch(e => {
                    fxdata = [],
                    showToast(e, !0)
                }
                ).finally( () => {
                    e && e(),
                    updateUI()
                }
                )
            }
            var jsonTimeout, pQL = [];
            function populateQL() {
                var e = "";
                if (pQL.length > 0) {
                    for (var t of (pQL.sort( (e, t) => e[0] > t[0]),
                    e += '<p class="labels hd">Quick load</p>',
                    pQL || []))
                        e += `<button class="btn btn-xs psts" id="p${t[0]}qlb" title="${t[2] ? t[2] : ""}" onclick="setPreset(${t[0]});">${t[1]}</button>`;
                    gId("pql").classList.add("expanded")
                } else
                    gId("pql").classList.remove("expanded");
                gId("pql").innerHTML = e
            }
            function populatePresets(e) {
                if (e && (pJson = JSON.parse(localStorage.getItem("wledP"))),
                pJson) {
                    delete pJson[0];
                    var t = ""
                      , s = Object.entries(pJson);
                    s.sort(cmpP),
                    pQL = [];
                    var n = [];
                    for (var l of (pNum = 0,
                    s || [])) {
                        if (!isObj(l[1]))
                            continue;
                        let e = parseInt(l[0]);
                        var a = l[1].ql;
                        a && pQL.push([e, a, pName(e)]),
                        n.push(e),
                        t += `<div class="pres lstI" id="p${e}o">`,
                        cfg.comp.pid && (t += `<div class="pid">${e}</div>`),
                        t += `<div class="pname lstIname" onclick="setPreset(${e})">${isPlaylist(e) ? "<i class='icons btn-icon'>&#xe139;</i>" : ""}${pName(e)}\n <i class="icons edit-icon flr" id="p${e}nedit" onclick="tglSegn(${e + 100})">&#xe2c6;</i></div>\n <i class="icons e-icon flr" id="sege${e + 100}" onclick="expand(${e + 100})">&#xe395;</i>\n <div class="presin lstIcontent" id="seg${e + 100}"></div>\n</div>`,
                        pNum++
                    }
                    gId("pcont").innerHTML = t,
                    pNum > 0 ? (pmtLS != pmt && 0 != pmt && (localStorage.setItem("wledPmt", pmt),
                    pJson[0] = {},
                    localStorage.setItem("wledP", JSON.stringify(pJson))),
                    pmtLS = pmt) : presetError(!0),
                    updatePA(),
                    populateQL()
                } else
                    setTimeout(loadPresets, 250)
            }
            function parseInfo(e) {
                //return  //kmo
                lastinfo = e;
                var t = e.name;
                gId("namelabel").innerHTML = t,
                t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f\u3131-\uD79D]/) || (gId("namelabel").style.transform = "rotate(180deg)"),
                "Dinnerbone" === t && (d.documentElement.style.transform = "rotate(180deg)"),
                e.live && (t = "(Live) " + t),
                loc && (t = "(L) " + t),
                d.title = t,
                ledCount = e.leds.count,
                syncTglRecv = e.str,
                maxSeg = e.leds.maxseg,
                pmt = e.fs.pmt,
                gId("buttonNodes").style.display = lastinfo.ndc > 0 ? null : "none",
                mw = e.leds.matrix ? e.leds.matrix.w : 0,
                mh = e.leds.matrix ? e.leds.matrix.h : 0,
                (isM = mw > 0 && mh > 0) ? (gId("filter0D").classList.add("hide"),
                gId("filter1D").classList.remove("hide"),
                gId("filter2D").classList.remove("hide")) : (gId("filter0D").classList.remove("hide"),
                gId("filter1D").classList.add("hide"),
                gId("filter2D").classList.add("hide"))
            }
            function populateInfo(e) {
                var t = ""
                  , s = e.freeheap / 1024;
                s = s.toFixed(1);
                var n = e.leds.pwr
                  , l = "Not calculated";
                n > 1e3 ? l = (n = (n /= 1e3).toFixed(n > 10 ? 0 : 1)) + " A" : n > 0 && (l = (n = 50 * Math.round(n / 50)) + " mA");
                var a = "";
                if (e.u)
                    for (const [t,s] of Object.entries(e.u))
                        s[1] ? a += inforow(t, s[0], s[1]) : a += inforow(t, s);
                var o = "Kuuhaku";
                e.ver.startsWith("0.14.") && (o = "Hoshi"),
                e.cn && (o = e.cn),
                t += `v${e.ver} "${o}"<br><br><table>\n${a}\n${"" === a ? "" : '<tr><td colspan=2><hr style="height:1px;border-width:0;color:gray;background-color:gray"></td></tr>'}\n${256 & e.opt ? inforow("Debug", '<button class="btn btn-xs" onclick="requestJson({\'debug\':' + (128 & e.opt ? "false" : "true") + '});"><i class="icons ' + (128 & e.opt ? "on" : "off") + '">&#xe08f;</i></button>') : ""}\n${inforow("Build", e.vid)}\n${inforow("Signal strength", e.wifi.signal + "% (" + e.wifi.rssi, " dBm)")}\n${inforow("Uptime", getRuntimeStr(e.uptime))}\n${inforow("Time", e.time)}\n${inforow("Free heap", s, " kB")}\n${e.psram ? inforow("Free PSRAM", (e.psram / 1024).toFixed(1), " kB") : ""}\n${inforow("Estimated current", l)}\n${inforow("Average FPS", e.leds.fps)}\n${inforow("MAC address", e.mac)}\n${inforow("Filesystem", e.fs.u + "/" + e.fs.t + " kB (" + Math.round(100 * e.fs.u / e.fs.t) + "%)")}\n${inforow("Environment", e.arch + " " + e.core + " (" + e.lwip + ")")}\n</table>`,
                gId("kv").innerHTML = t;
                for (let e of gId("kv").getElementsByClassName("sliderdisplay") || []) {
                    let t = e.previousElementSibling;
                    t && updateTrail(t)
                }
            }
            function populateSegments(e) {
                //return   //kmo
                var t = "";
                let s = lastinfo;
                for (var n of (segCount = 0,
                lowestUnused = 0,
                lSeg = 0,
                e.seg || [])) {
                    segCount++;
                    let l = parseInt(n.id);
                    l == lowestUnused && (lowestUnused = l + 1),
                    l > lSeg && (lSeg = l);
                    let a = gId("seg" + l)
                      , o = !!a && (a.classList.contains("expanded") || 0 === l && cfg.comp.segexp)
                      , i = "var(--c-b)";
                    switch (n.set) {
                    case 1:
                        i = "var(--c-r)";
                        break;
                    case 2:
                        i = "var(--c-g)";
                        break;
                    case 3:
                        i = "var(--c-l)"
                    }
                    let r = `<div id="segp${l}" class="sbs"><i class="icons slider-icon pwr ${n.on ? "act" : ""}" id="seg${l}pwr" onclick="setSegPwr(${l})">&#xe08f;</i><div class="sliderwrap il"><input id="seg${l}bri" class="noslide" onchange="setSegBri(${l})" oninput="updateTrail(this)" max="255" min="1" type="range" value="${n.bri}" /><div class="sliderdisplay"></div></div></div>`
                      , c = n.start
                      , d = n.stop
                      , p = n.startY
                      , g = n.stopY
                      , u = isM && c < mw * mh
                      , f = `<label class="check revchkl">Reverse ${isM ? "" : "direction"}<input type="checkbox" id="seg${l}rev" onchange="setRev(${l})" ${n.rev ? "checked" : ""}><span class="checkmark"></span></label>`
                      , v = `<label class="check revchkl">Mirror<input type="checkbox" id="seg${l}mi" onchange="setMi(${l})" ${n.mi ? "checked" : ""}><span class="checkmark"></span></label>`
                      , h = ""
                      , m = "";
                    u && (h = `<label class="check revchkl">Reverse<input type="checkbox" id="seg${l}rY" onchange="setRevY(${l})" ${n.rY ? "checked" : ""}><span class="checkmark"></span></label>`,
                    m = `<label class="check revchkl">Mirror<input type="checkbox" id="seg${l}mY" onchange="setMiY(${l})" ${n.mY ? "checked" : ""}><span class="checkmark"></span></label>`);
                    let b = `<div id="seg${l}map2D" data-map="map2D" class="lbl-s hide">Expand 1D FX<br><div class="sel-p"><select class="sel-p" id="seg${l}m12" onchange="setM12(${l})"><option value="0" ${0 == n.m12 ? " selected" : ""}>Pixels</option><option value="1" ${1 == n.m12 ? " selected" : ""}>Bar</option><option value="2" ${2 == n.m12 ? " selected" : ""}>Arc</option><option value="3" ${3 == n.m12 ? " selected" : ""}>Corner</option></select></div></div>`
                      , I = `<div data-snd="si" class="lbl-s hide">Sound sim<br><div class="sel-p"><select class="sel-p" id="seg${l}si" onchange="setSi(${l})"><option value="0" ${0 == n.si ? " selected" : ""}>BeatSin</option><option value="1" ${1 == n.si ? " selected" : ""}>WeWillRockYou</option></select></div></div>`;
                    t += `<div class="seg lstI ${l == e.mainseg ? "selected" : ""} ${o ? "expanded" : ""}" id="seg${l}" data-set="${n.set}"><label class="check schkl"><input type="checkbox" id="seg${l}sel" onchange="selSeg(${l})" ${n.sel ? "checked" : ""}><span class="checkmark"></span></label><div class="segname" onclick="selSegEx(${l})"><i class="icons e-icon frz" id="seg${l}frz" onclick="event.preventDefault();tglFreeze(${l});">&#x${n.frz ? s.live && s.liveseg == l ? "e410" : "e0e8" : "e325"};</i>` + (n.n ? n.n : "Segment " + l) + '<div class="pop hide" onclick="event.preventDefault();event.stopPropagation();">' + `<i class="icons g-icon" style="color:${i};" onclick="this.nextElementSibling.classList.toggle('hide');">&#x278${String.fromCharCode(n.set + "A".charCodeAt(0))};</i>` + `<div class="pop-c hide"><span style="color:var(--c-f);" onclick="setGrp(${l},0);">&#x278A;</span><span style="color:var(--c-r);" onclick="setGrp(${l},1);">&#x278B;</span><span style="color:var(--c-g);" onclick="setGrp(${l},2);">&#x278C;</span><span style="color:var(--c-l);" onclick="setGrp(${l},3);">&#x278D;</span></div></div> ` + `<i class="icons edit-icon flr" id="seg${l}nedit" onclick="tglSegn(${l})">&#xe2c6;</i></div>` + `<i class="icons e-icon flr" id="sege${l}" onclick="expand(${l})">&#xe395;</i>` + (cfg.comp.segpwr ? r : "") + `<div class="segin" id="seg${l}in">` + `<input type="text" class="ptxt" id="seg${l}t" autocomplete="off" maxlength=${"esp8266" == s.arch ? 32 : 64} value="${n.n ? n.n : ""}" placeholder="Enter name..."/><table class="infot segt"><tr>` + `<td>${u ? "Start X" : "Start LED"}</td>` + `<td>${u ? cfg.comp.seglen ? "Width" : "Stop X" : cfg.comp.seglen ? "LED count" : "Stop LED"}</td>` + `<td>${u ? "" : "Offset"}</td></tr><tr>` + `<td><input class="segn" id="seg${l}s" type="number" min="0" max="${(u ? mw : ledCount) - 1}" value="${c}" oninput="updateLen(${l})" onkeydown="segEnter(${l})"></td>` + `<td><input class="segn" id="seg${l}e" type="number" min="0" max="${u ? mw : ledCount}" value="${d - (cfg.comp.seglen ? c : 0)}" oninput="updateLen(${l})" onkeydown="segEnter(${l})"></td>` + `<td ${u ? 'style="text-align:revert;"' : ""}>${u ? v + "<br>" + f : ""}<input class="segn ${u ? "hide" : ""}" id="seg${l}of" type="number" value="${n.of}" oninput="updateLen(${l})"></td></tr>` + (u ? "<tr><td>Start Y</td><td>" + (cfg.comp.seglen ? "Height" : "Stop Y") + '</td><td></td></tr><tr><td><input class="segn" id="seg' + l + 'sY" type="number" min="0" max="' + (mh - 1) + '" value="' + p + '" oninput="updateLen(' + l + ')" onkeydown="segEnter(' + l + ')"></td><td><input class="segn" id="seg' + l + 'eY" type="number" min="0" max="' + mh + '" value="' + (g - (cfg.comp.seglen ? p : 0)) + '" oninput="updateLen(' + l + ')" onkeydown="segEnter(' + l + ')"></td><td style="text-align:revert;">' + m + "<br>" + h + "</td></tr>" : "") + "<tr><td>Grouping</td><td>Spacing</td><td></td></tr><tr>" + `<td><input class="segn" id="seg${l}grp" type="number" min="1" max="255" value="${n.grp}" oninput="updateLen(${l})" onkeydown="segEnter(${l})"></td>` + `<td><input class="segn" id="seg${l}spc" type="number" min="0" max="255" value="${n.spc}" oninput="updateLen(${l})" onkeydown="segEnter(${l})"></td>` + `<td><button class="btn btn-xs" onclick="setSeg(${l})"><i class="icons btn-icon" id="segc${l}">&#xe390;</i></button></td></tr></table>` + `<div class="h bp" id="seg${l}len"></div>` + (u ? "" : f) + (u && g - p > 1 && d - c > 1 ? b : "") + (e.AudioReactive && e.AudioReactive.on ? "" : I) + `<label class="check revchkl" id="seg${l}lbtm">` + (u ? "Transpose" : "Mirror effect") + (u ? '<input type="checkbox" id="seg' + l + 'tp" onchange="setTp(' + l + ')" ' + (n.tp ? "checked" : "") + ">" : '<input type="checkbox" id="seg' + l + 'mi" onchange="setMi(' + l + ')" ' + (n.mi ? "checked" : "") + ">") + '<span class="checkmark"></span></label><div class="del">' + `<button class="btn btn-xs" id="segr${l}" title="Repeat until end" onclick="rptSeg(${l})"><i class="icons btn-icon">&#xe22d;</i></button>` + `<button class="btn btn-xs" id="segd${l}" title="Delete" onclick="delSeg(${l})"><i class="icons btn-icon">&#xe037;</i></button></div></div>` + (cfg.comp.segpwr ? "" : r) + "</div>"
                }
                gId("segcont").innerHTML = t;
                let l = lowestUnused >= maxSeg;
                resetUtil(l),
                gId("selall") && (gId("selall").checked = !0);
                for (var a = 0; a <= lSeg; a++)
                    gId("seg" + a) && (updateLen(a),
                    updateTrail(gId(`seg${a}bri`)),
                    gId("segr" + a).classList.add("hide"),
                    !gId(`seg${a}sel`).checked && gId("selall") && (gId("selall").checked = !1));
                if (segCount < 2 && (gId("segd" + lSeg).classList.add("hide"),
                255 == parseInt(gId("seg0bri").value) && gId("segp0").classList.add("hide")),
                !isM && !l && (cfg.comp.seglen ? parseInt(gId(`seg${lSeg}s`).value) : 0) + parseInt(gId(`seg${lSeg}e`).value) < ledCount && gId("segr" + lSeg).classList.remove("hide"),
                gId("segutil2").style.display = segCount > 1 ? "block" : "none",
                Array.isArray(s.maps) && s.maps.length > 1) {
                    let e = 'Ledmap:&nbsp;<select class="sel-sg" onchange="requestJson({\'ledmap\':parseInt(this.value)})"><option value="" selected>Unchanged</option>';
                    for (const t of s.maps || [])
                        e += `<option value="${t.id}">${0 == t.id ? "Default" : t.n ? t.n : "ledmap" + t.id + ".json"}</option>`;
                    e += "</select></div>",
                    gId("ledmap").innerHTML = e,
                    gId("ledmap").classList.remove("hide")
                } else
                    gId("ledmap").classList.add("hide")
            }
            function populateEffects() {
                var e = eJson
                  , t = "";
                e.shift();
                for (let t = 0; t < e.length; t++)
                    e[t] = {
                        id: e[t][0],
                        name: e[t][1]
                    };
                e.sort( (e, t) => e.name.localeCompare(t.name)),
                e.unshift({
                    id: 0,
                    name: "Solid"
                });
                for (let s of e) {
                    let e = s.id
                      , n = s.name + " "
                      , l = "";
                    if (s.name.indexOf("RSVD") < 0) {
                        if (Array.isArray(fxdata) && fxdata.length > e) {
                            l = 0 == fxdata[e].length ? ";;!;1" : fxdata[e];
                            let t = "" == l ? [] : l.split(";")
                              , s = t.length < 3 || "" === t[2] ? [] : t[2].split(",");
                            s.length > 0 && "" !== s[0] && !isNumeric(s[0]) && (n += "&#x1F3A8;");
                            let a = t.length < 4 || "" === t[3] ? "1" : t[3];
                            0 == e && (a = ""),
                            a.length > 0 && (a.includes("0") && (n += "&#8226;"),
                            a.includes("1") && (n += "&#8942;"),
                            a.includes("2") && (n += "&#9638;"),
                            a.includes("v") && (n += "&#9834;"),
                            a.includes("f") && (n += "&#9835;"))
                        }
                        t += generateListItemHtml("fx", e, n, "setFX", "", l)
                    }
                }
                gId("fxlist").innerHTML = t
            }
            function populatePalettes() {
                lJson.shift(),
                lJson.sort( (e, t) => e[1].localeCompare(t[1])),
                lJson.unshift([0, "Default"]);
                var e = "";
                for (let t of lJson)
                    e += generateListItemHtml("palette", t[0], t[1], "setPalette", `<div class="lstIprev" style="${genPalPrevCss(t[0])}"></div>`);
            
                if (gId("pallist").innerHTML = e,
         
                !isEmpty(lastinfo) && lastinfo.cpalcount)
                    for (let e = 0; e < lastinfo.cpalcount; e++) {
                        let t = d.createElement("div");
                        gId("pallist").appendChild(t),
                        t.outerHTML = generateListItemHtml("palette", 255 - e, "~ Custom " + e + " ~", "setPalette", `<div class="lstIprev" style="${genPalPrevCss(255 - e)}"></div>`)
                    }
            }
            function redrawPalPrev() {
                let e = d.querySelectorAll("#pallist .lstI");
                for (var t of e || []) {
                    let e = t.querySelector(".lstIprev");
                    e && (e.style = genPalPrevCss(t.dataset.id))
                }
            }
            function genPalPrevCss(e) {
                if (palettesData) {
                    var t = palettesData[e];
                    if (!t)
                        return "display: none";
                    1 == t.length && (t[1] = t[0],
                    Array.isArray(t[1]) && (t[1][0] = 255));
                    var s = [];
                    for (let e = 0; e < t.length; e++) {
                        const l = t[e];
                        let a, o, i, r = !1;
                        if (Array.isArray(l))
                            r = Math.round(l[0] / 255 * 100),
                            a = l[1],
                            o = l[2],
                            i = l[3];
                        else if ("r" == l)
                            a = 255 * Math.random(),
                            o = 255 * Math.random(),
                            i = 255 * Math.random();
                        else {
                            let e = l[1] - 1;
                            var n = gId("csl").children;
                            a = parseInt(n[e].dataset.r),
                            o = parseInt(n[e].dataset.g),
                            i = parseInt(n[e].dataset.b)
                        }
                        !1 === r && (r = Math.round(e / t.length * 100)),
                        s.push(`rgb(${a},${o},${i}) ${r}%`)
                    }
                    return `background: linear-gradient(to right,${s.join()});`
                }
            }
            function generateListItemHtml(e, t, s, n, l="", a="") {
                return `<div class="lstI${0 == t ? " sticky" : ""}" data-id="${t}" ${"" === a ? "" : 'data-opt="' + a + '" '}onClick="${n}(${t})"><label title="(${t})" class="radio schkl" onclick="event.preventDefault()"><input type="radio" value="${t}" name="${e}"><span class="radiomark"></span><div class="lstIcontent"><span class="lstIname">${s}</span></div></label>` + l + "</div>"
            }
            function btype(e) {
                switch (e) {
                case 2:
                case 32:
                    return "ESP32";
                case 3:
                case 33:
                    return "ESP32-S2";
                case 4:
                case 34:
                    return "ESP32-S3";
                case 5:
                case 35:
                    return "ESP32-C3";
                case 1:
                case 82:
                    return "ESP8266"
                }
                return "?"
            }
            function bname(e) {
                return "WLED" == e.name ? e.ip : e.name
            }
            function populateNodes(e, t) {
                var s = ""
                  , n = ""
                  , l = 0;
                if (t.nodes)
                    for (var a of (t.nodes.sort( (e, t) => e.name.localeCompare(t.name)),
                    t.nodes))
                        if (a.name) {
                            let e = `<i class="icons e-icon flr ${128 & a.type ? "" : "off"}" onclick="rmtTgl('${a.ip}',this);"">&#xe08f;</i>`;
                            n += inforow(`<button class="btn" title="${a.ip}" onclick="location.assign('http://${a.ip}');"><div class="bname">${bname(a)}</div>${a.vid < 2307130 ? "" : e}</button>`, `${btype(127 & a.type)}<br><i>${0 == a.vid ? "N/A" : a.vid}</i>`),
                            l++
                        }
                e.ndc < 0 ? s += "Instance List is disabled." : 0 == l && (s += "No other instances found."),
                s += `<table>\n ${inforow("Current instance:", e.name)}\n ${n}\n </table>`,
                gId("kn").innerHTML = s
            }
            function loadNodes() {
                fetch(getURL("/json/nodes"), {
                    method: "get"
                }).then(e => (e.ok || showToast("Could not load Node list!", !0),
                e.json())).then(e => {
                    //kmo clearErrorToast(100),
                    //kmo populateNodes(lastinfo, e)
                }
                ).catch(e => {
                    showToast(e, !0)
                }
                )
            }
            function updateTrail(e) {
                if (null == e)
                    return;
                let t = e.parentNode.getElementsByClassName("sliderdisplay")[0];
                if (t && "none" !== getComputedStyle(t).getPropertyValue("--bg")) {
                    var s = e.hasAttribute("max") ? e.attributes.max.value : 255
                      , n = Math.round(100 * e.value / s);
                    n < 50 && (n += 2);
                    var l = `linear-gradient(90deg, var(--bg) ${n}%, var(--c-6) ${n}%)`;
                    t.style.backgroundImage = l
                }
                var a = e.parentNode.parentNode.getElementsByTagName("output")[0];
                a && (a.innerHTML = e.value)
            }
            function toggleBubble(e) {
                e.target.parentNode.parentNode.getElementsByTagName("output")[0].classList.toggle("sliderbubbleshow")
            }
            function updateLen(e) {
                if (!gId(`seg${e}s`))
                    return;
                var t = parseInt(gId(`seg${e}s`).value)
                  , s = parseInt(gId(`seg${e}e`).value) + (cfg.comp.seglen ? t : 0)
                  , n = s - t;
                let l = gId(`seg${e}sY`)
                  , a = gId(`seg${e}eY`)
                  , o = gId(`seg${e}s`)
                  , i = gId(`seg${e}e`)
                  , r = gId(`seg${e}of`)
                  , c = gId("mkSYH")
                  , d = gId("mkSYD");
                if (isM)
                    if (t >= mw * mh)
                        l && (l.value = 0,
                        l.max = 0,
                        l.min = 0),
                        a && (a.value = 1,
                        a.max = 1,
                        a.min = 0),
                        o.min = mw * mh,
                        o.max = ledCount - 1,
                        i.min = mw * mh + 1,
                        i.max = ledCount,
                        c && c.classList.add("hide"),
                        d && d.classList.add("hide"),
                        r && r.classList.remove("hide");
                    else {
                        c && c.classList.remove("hide"),
                        d && d.classList.remove("hide"),
                        r && r.classList.add("hide");
                        let o = parseInt(l.value)
                          , i = parseInt(a.value) + (cfg.comp.seglen ? o : 0);
                        n *= i - o;
                        let p = gId(`seg${e}lbtm`);
                        if (s - t > 1 && i - o > 1) {
                            p && p.classList.remove("hide");
                            let t = gId("fxlist").querySelector(`.lstI[data-id="${selectedFx}"]`);
                            if (t) {
                                let s = t.querySelector(".lstIname").innerText
                                  , n = gId(`seg${e}map2D`);
                                n && (s.indexOf("▦") < 0 ? n.classList.remove("hide") : n.classList.add("hide"))
                            }
                        } else
                            p && (p.classList.add("hide"),
                            gId(`seg${e}tp`).checked = !1)
                    }
                var p = "(delete)";
                if (n > 1 ? p = n + " LEDs" : 1 == n && (p = "1 LED"),
                null != gId(`seg${e}grp`)) {
                    var g = parseInt(gId(`seg${e}grp`).value)
                      , u = parseInt(gId(`seg${e}spc`).value);
                    0 == g && (g = 1);
                    var f = Math.ceil(n / (g + u));
                    !isNaN(f) && (g > 1 || u > 0) && (p += ` (${f} virtual)`)
                }
                isM && t >= mw * mh && (p += " [strip]"),
                gId(`seg${e}len`).innerHTML = p
            }
            function updatePA() {
                let e;
                e = gEBCN("pres");
                for (let t of e)
                    t.classList.remove("selected");
                e = gEBCN("psts");
                for (let t of e)
                    t.classList.remove("selected");
                if (currentPreset > 0) {
                    var t = gId(`p${currentPreset}o`);
                    t && t.classList.add("selected"),
                    (t = gId(`p${currentPreset}qlb`)) && t.classList.add("selected")
                }
            }
            function updateUI() {
                gId("buttonPower").className = isOn ? "active" : "",
                //kmo gId("buttonNl").className = nlA ? "active" : "",
                //kmo gId("buttonSync").className = syncSend ? "active" : "",
                updateSelectedFx(),
                updateSelectedPalette(selectedPal),
                updateTrail(gId("sliderBri")),
                updateTrail(gId("sliderSpeed")),
                updateTrail(gId("sliderIntensity")),
                updateTrail(gId("sliderC1")),
                updateTrail(gId("sliderC2")),
                updateTrail(gId("sliderC3")),
                hasRGB && (updateTrail(gId("sliderR")),
                updateTrail(gId("sliderG")),
                updateTrail(gId("sliderB"))),
                hasWhite && updateTrail(gId("sliderW"));
                var e = cfg.comp.colors;
                gId("wwrap").style.display = hasWhite ? "block" : "none",
                gId("wbal").style.display = hasCCT ? "block" : "none",
                gId("hexw").style.display = e.hex ? "block" : "none",
                gId("picker").style.display = hasRGB && e.picker ? "block" : "none",
                gId("hwrap").style.display = hasRGB && !e.picker ? "block" : "none",
                gId("swrap").style.display = hasRGB && !e.picker ? "block" : "none",
                gId("vwrap").style.display = hasRGB ? "block" : "none",
                gId("kwrap").style.display = hasRGB && !hasCCT ? "block" : "none",
                gId("rgbwrap").style.display = hasRGB && e.rgb ? "block" : "none",
                gId("qcs-w").style.display = hasRGB && e.quick ? "block" : "none",
                updatePA(),
                updatePSliders()
            }
            function updateSelectedPalette(e) {
                var t = gId("pallist")
                  , s = t.querySelector(`input[name="palette"][value="${e}"]`);
                s && (s.checked = !0);
                var n = t.querySelector(".selected");
                n && n.classList.remove("selected"),
                t.querySelector(`.lstI[data-id="${e}"]`) && t.querySelector(`.lstI[data-id="${e}"]`).classList.add("selected");
                let l = gId("csl").children;
                if (e > 1 && e < 6)
                    l[0].classList.remove("hide"),
                    e > 2 && l[1].classList.remove("hide"),
                    e > 3 && l[2].classList.remove("hide");
                else
                    for (let e of l)
                        "1" == e.dataset.hide && e.classList.add("hide")
            }
            function updateSelectedFx() {
                var e = gId("fxlist")
                  , t = e.querySelector(`input[name="fx"][value="${selectedFx}"]`);
                t && (t.checked = !0);
                var s = e.querySelector(".selected");
                s && (s.classList.remove("selected"),
                s.style.bottom = null);
                var n = e.querySelector(`.lstI[data-id="${selectedFx}"]`);
                if (n) {
                    n.classList.add("selected"),
                    setEffectParameters(selectedFx);
                    var l = e.querySelectorAll(".lstI");
                    for (const e of l) {
                        if (!e.dataset.opt)
                            continue;
                        let t = e.dataset.opt.split(";");
                        e.dataset.id > 0 && (0 == segLmax || 1 == segLmax && (!t[3] || t[3].indexOf("0") < 0) || !isM && t[3] && t[3].indexOf("2") >= 0 && t[3].indexOf("1") < 0 ? e.classList.add("hide") : e.classList.remove("hide"))
                    }
                    var a = n.querySelector(".lstIname").innerText
                      , o = gId("segcont").querySelectorAll('div[data-map="map2D"]');
                    for (const e of o)
                        a.indexOf("▦") < 0 ? e.classList.remove("hide") : e.classList.add("hide");
                    o = gId("segcont").querySelectorAll('div[data-snd="si"]');
                    for (const e of o)
                        a.indexOf("♪") < 0 && a.indexOf("♫") < 0 ? e.classList.add("hide") : e.classList.remove("hide")
                }
            }
            function displayRover(e, t) {
                gId("rover").style.transform = e.live && 0 == t.lor && e.liveseg < 0 ? "translateY(0px)" : "translateY(100%)";
                var s = e.lip ? e.lip : "";
                s.length > 2 && (s = " from " + s),
                gId("lv").innerHTML = `WLED is receiving live ${e.lm} data${s}`,
                gId("roverstar").style.display = e.live && t.lor ? "block" : "none"
            }
            function cmpP(e, t) {
                if (cfg.comp.idsort || !e[1].n)
                    return parseInt(e[0]) > parseInt(t[0]);
                const s = e[1].n.charCodeAt(0)
                  , n = t[1].n.charCodeAt(0);
                x = s > 47 && s < 58 || s > 64 && s < 91 || s > 96 && s < 123 || s > 255 ? "=" : ">",
                y = n > 47 && n < 58 || n > 64 && n < 91 || n > 96 && n < 123 || n > 255 ? "=" : ">";
                return ((e[1].playlist ? "<" : x) + e[1].n).localeCompare((t[1].playlist ? "<" : y) + t[1].n, void 0, {
                    numeric: !0
                })
            }
            function makeWS() {
                return //kmo
                if (ws || lastinfo.ws < 0)
                    return;
                let e = loc ? getURL("/ws").replace("http", "ws") : "ws://" + window.location.hostname + "/ws";
                (ws = new WebSocket(e)).binaryType = "arraybuffer",
                ws.onmessage = e => {
                    if (!(e.data instanceof ArrayBuffer)) {
                        var t = JSON.parse(e.data);
                        if (!t.leds) {
                            clearTimeout(jsonTimeout),
                            jsonTimeout = null,
                            lastUpdate = new Date,
                            clearErrorToast(),
                            gId("connind").style.backgroundColor = "var(--c-l)";
                            var s = t.info;
                            s ? (parseInfo(s),
                            isInfo && populateInfo(s)) : s = lastinfo;
                            var n = t.state ? t.state : t;
                            displayRover(s, n),
                            readState(n)
                        }
                    }
                }
                ,
                ws.onclose = e => {
                    gId("connind").style.backgroundColor = "var(--c-r)",
                    wsRpt++ < 5 && setTimeout(makeWS, 1500),
                    ws = null
                }
                ,
                ws.onopen = e => {
                    wsRpt = 0,
                    reqsLegal = !0
                }
            }
            function readState(e, t=!1) {
                if (!e)
                    return !1;
                if (e.success)
                    return !0;
                isOn = e.on,
                gId("sliderBri").value = e.bri,
                nlA = e.nl.on,
                nlDur = e.nl.dur,
                nlTar = e.nl.tbri,
                nlFade = e.nl.fade,
                syncSend = e.udpn.send,
                currentPreset = e.pl < 0 ? e.ps : e.pl,
                tr = e.transition,
                gId("tt").value = tr / 10,
                populateSegments(e);
                var s = 0
                  , n = 0;
                hasRGB = hasWhite = hasCCT = !1,
                segLmax = 0;
                //return //kmo
                for (let t = 0; t < (e.seg || []).length; t++)
                    if (0 == n && e.seg[t].id == e.mainseg && (s = t,
                    n = 1),
                    e.seg[t].sel) {
                        n < 2 && (s = t),
                        n = 2;
                        var l = lastinfo.leds.seglc[e.seg[t].id];
                        hasRGB |= !!(1 & l),
                        hasWhite |= !!(2 & l),
                        hasCCT |= !!(4 & l);
                        let a = (e.seg[t].stop - e.seg[t].start) * (e.seg[t].stopY ? e.seg[t].stopY - e.seg[t].startY : 1);
                        segLmax = segLmax < a ? a : segLmax
                    }
                var a = e.seg[s];
                if (1 == n) {
                    l = lastinfo.leds.seglc[a.id];
                    hasRGB = !!(1 & l),
                    hasWhite = !!(2 & l),
                    hasCCT = !!(4 & l)
                }
                if (!a)
                    return showToast("No Segments!", !0),
                    updateUI(),
                    !0;
                e.seg.length > 2 && d.querySelectorAll(".pop").forEach(e => {
                    e.classList.remove("hide")
                }
                );
                var o = gId("csl").children;
                for (let e = o.length - 1; e >= 0; e--)
                    o[e].dataset.r = a.col[e][0],
                    o[e].dataset.g = a.col[e][1],
                    o[e].dataset.b = a.col[e][2],
                    (hasWhite || !hasRGB && !hasWhite) && (o[e].dataset.w = a.col[e][3]),
                    setCSL(o[e]);
                if (selectSlot(csel),
                null != a.cct && a.cct >= 0 && (gId("sliderA").value = a.cct),
                gId("sliderSpeed").value = a.sx,
                gId("sliderIntensity").value = a.ix,
                gId("sliderC1").value = a.c1 ? a.c1 : 0,
                gId("sliderC2").value = a.c2 ? a.c2 : 0,
                gId("sliderC3").value = a.c3 ? a.c3 : 0,
                gId("checkO1").checked = !!a.o1,
                gId("checkO2").checked = !!a.o2,
                gId("checkO3").checked = !!a.o3,
                e.error && 0 != e.error) {
                    var i = "";
                    switch (e.error) {
                    case 10:
                        i = "Could not mount filesystem!";
                        break;
                    case 11:
                        i = "Not enough space to save preset!";
                        break;
                    case 12:
                        i = "Preset not found.";
                        break;
                    case 13:
                        i = "Missing ir.json.";
                        break;
                    case 19:
                        i = "A filesystem error has occured."
                    }
                    showToast("Error " + e.error + ": " + i, !0)
                }
                return selectedPal = a.pal,
                selectedFx = a.fx,
                redrawPalPrev(),
                updateUI(),
                !0
            }
            function setEffectParameters(e) {
                if (!(Array.isArray(fxdata) && fxdata.length > e))
                    return;
                var t = fxdata[e].length
                  , s = fxdata[e]
                  , n = "" == s ? [] : s.split(";")
                  , l = 0 == n.length || "" == n[0] ? [] : n[0].split(",")
                  , a = n.length < 2 || "" == n[1] ? [] : n[1].split(",")
                  , o = n.length < 3 || "" == n[2] ? [] : n[2].split(",");
                for (let s = 0; s < 5; s++) {
                    var i = gId("slider" + s)
                      , r = gId("sliderLabel" + s);
                    !t && s < (e < 128 ? 2 : 5) || l.length > s && "" != l[s] ? (l.length > s && "!" != l[s] ? r.innerHTML = l[s] : r.innerHTML = 0 == s ? "Effect speed" : 1 == s ? "Effect intensity" : "Custom" + (s - 1),
                    i.classList.remove("hide")) : i.classList.add("hide")
                }
                if (l.length > 5) {
                    gId("fxopt").classList.remove("fade");
                    for (let e = 0; e < 3; e++)
                        5 + e < l.length && "" !== l[5 + e] ? (gId("opt" + e).classList.remove("hide"),
                        gId("optLabel" + e).innerHTML = "!" == l[5 + e] ? "Option" : l[5 + e].substr(0, 16)) : gId("opt" + e).classList.add("hide")
                } else
                    gId("fxopt").classList.add("fade");
                function c() {
                    let e = parseInt(getComputedStyle(gId("sliders")).height);
                    e += 5;
                    let t = d.querySelector("#fxlist .selected");
                    t && (t.style.bottom = e + "px")
                }
                c(),
                setInterval(c, 750);
                var p = ""
                  , g = ""
                  , u = 0
                  , f = csel;
                for (let e = 0; e < gId("csl").children.length; e++) {
                    var v = gId("csl" + e);
                    if (a.length > e && "" != a[e]) {
                        if (v.classList.remove("hide"),
                        v.dataset.hide = 0,
                        "!" != a[e]) {
                            var h = a[e].substr(0, 2);
                            v.innerHTML = h,
                            h != a[e] && (p += g + h + "=" + a[e],
                            g = ", ")
                        } else
                            v.innerHTML = 0 == e ? "Fx" : 1 == e ? "Bg" : "Cs";
                        u && f != e || selectSlot(e),
                        u++
                    } else
                        t ? (v.classList.add("hide"),
                        v.dataset.hide = 1,
                        v.innerHTML = "" + (e + 1)) : (v.classList.remove("hide"),
                        v.dataset.hide = 0,
                        v.innerHTML = "" + (e + 1),
                        u && f != e || selectSlot(e),
                        u++)
                }
                gId("cslLabel").innerHTML = p;
                var m = gId("palw")
                  , b = gId("pall");
                if (hasRGB && (!t || o.length > 0 && "" != o[0] && isNaN(o[0]))) {
                    if (m.style.display = "inline-block",
                    o.length > 0 && o[0].indexOf("=") > 0) {
                        var I = o[0].indexOf("=");
                        Math.max(0, Math.min(255, parseInt(o[0].substr(I + 1))));
                        o[0] = o[0].substring(0, I)
                    }
                    o.length > 0 && "!" != o[0] ? b.innerHTML = o[0] : b.innerHTML = '<i class="icons sel-icon" onclick="tglHex()">&#xe2b3;</i> Color palette'
                } else
                    b.innerHTML = '<i class="icons sel-icon" onclick="tglHex()">&#xe2b3;</i> Color palette not used',
                    m.style.display = "none"
            }
            var reqsLegal = !1;
            function requestJson(e=null) {
                if (gId("connind").style.backgroundColor = "var(--c-y)",
                !e || reqsLegal) {
                    jsonTimeout || (jsonTimeout = setTimeout( () => {
                        ws && ws.close(),
                        ws = null,
                        showErrorToast()
                    }
                    , 3e3));
                    var t = null
                      , s = ws && ws.readyState === WebSocket.OPEN
                      , n = e ? "post" : "get";
                    if (e) {
                        e.v = !0,
                        e.time = Math.floor(Date.now() / 1e3);
                        var l = gId("tt");
                        if (l.validity.valid && null == e.transition) {
                            var a = parseInt(10 * l.value);
                            a != tr && (e.transition = a)
                        }
                        (t = JSON.stringify(e)).length > 1340 && (s = !1),
                        t.length > 500 && lastinfo && "esp8266" == lastinfo.arch && (s = !1)
                    }
                    s ? ws.send(t || '{"v":true}') : fetch(getURL("/json/si"), {
                        method: n,
                        headers: {
                            "Content-type": "application/json; charset=UTF-8"
                        },
                        body: t
                    }).then(e => (clearTimeout(jsonTimeout),
                    jsonTimeout = null,
                    e.ok || showErrorToast(),
                    e.json())).then(e => {
                        if (lastUpdate = new Date,
                        clearErrorToast(3e3),
                        gId("connind").style.backgroundColor = "var(--c-g)",
                        e) {
                            if (!e.success) {
                                if (e.info) {
                                    let t = e.info;
                                    parseInfo(t),
                                    populatePalettes(t),
                                    isInfo && populateInfo(t)
                                }
                                readState(e.state ? e.state : e),
                                pJson && !isEmpty(pJson) || setTimeout( () => {
                                    loadPresets( () => {
                                        wsRpt = 0,
                                        ws && ws.readyState === WebSocket.OPEN || makeWS()
                                    }
                                    )
                                }
                                , 25),
                                reqsLegal = !0
                            }
                        } else
                            showToast("Empty response", !0)
                    }
                    ).catch(e => {
                        showToast(e, !0)
                    }
                    )
                }
            }
            function togglePower() {
                var e = {
                    on: isOn = !isOn
                };
                isOn && lastinfo && lastinfo.live && lastinfo.liveseg >= 0 && (e.live = !1,
                e.seg = [],
                e.seg[0] = {
                    id: lastinfo.liveseg,
                    frz: !1
                }),
                requestJson(e)
            }
            function toggleNl() {
                showToast((nlA = !nlA) ? `Timer active. Your light will turn ${nlTar > 0 ? "on" : "off"} ${nlMode ? "over" : "after"} ${nlDur} minutes.` : "Timer deactivated."),
                requestJson({
                    nl: {
                        on: nlA
                    }
                })
            }
            function toggleSync() {
                showToast((syncSend = !syncSend) ? "Other lights in the network will now sync to this one." : "This light and other lights in the network will no longer sync.");
                var e = {
                    udpn: {
                        send: syncSend
                    }
                };
                syncTglRecv && (e.udpn.recv = syncSend),
                requestJson(e)
            }
            function toggleLiveview() {
                isInfo && isM && toggleInfo(),
                isNodes && isM && toggleNodes(),
                isLv = !isLv;
                let e = ws && ws.readyState === WebSocket.OPEN;
                var t = "liveview";
                isM && e && (t += "2D",
                isLv && (gId("klv2D").innerHTML = `<iframe id="${t}" src="about:blank"></iframe>`),
                gId("mlv2D").style.transform = isLv ? "translateY(0px)" : "translateY(100%)"),
                gId(t).style.display = isLv ? "block" : "none",
                gId(t).src = isLv ? getURL("/" + t + (e ? "?ws" : "")) : "about:blank",
                gId("buttonSr").classList.toggle("active"),
                !isLv && e && ws.send('{"lv":false}'),
                size()
            }
            function toggleInfo() {
                isNodes && toggleNodes(),
                isLv && isM && toggleLiveview(),
                (isInfo = !isInfo) && requestJson(),
                gId("info").style.transform = isInfo ? "translateY(0px)" : "translateY(100%)",
                gId("buttonI").className = isInfo ? "active" : ""
            }
            function toggleNodes() {
                isInfo && toggleInfo(),
                isLv && isM && toggleLiveview(),
                (isNodes = !isNodes) && loadNodes(),
                gId("nodes").style.transform = isNodes ? "translateY(0px)" : "translateY(100%)",
                gId("buttonNodes").className = isNodes ? "active" : ""
            }
            function makeSeg() {
                var e = 0
                  , t = 0
                  , s = lowestUnused;
                if (s > 0) {
                    let n = parseInt(gId(`seg${s - 1}e`).value, 10) + (cfg.comp.seglen ? parseInt(gId(`seg${s - 1}s`).value, 10) : 0);
                    isM ? (e = 0,
                    t = mw) : (n < ledCount && (e = n),
                    t = ledCount - (cfg.comp.seglen ? e : 0))
                }
                gId("segutil").scrollIntoView({
                    behavior: "smooth",
                    block: "start"
                });
                var n = `<div class="seg lstI expanded"><div class="segin"><input type="text" id="seg${s}t" autocomplete="off" maxlength=32 value="" placeholder="New segment ${s}"/><table class="segt"><tr><td width="38%">${isM ? "Start X" : "Start LED"}</td><td width="38%">${isM ? cfg.comp.seglen ? "Width" : "Stop X" : cfg.comp.seglen ? "LED count" : "Stop LED"}</td></tr><tr><td><input class="segn" id="seg${s}s" type="number" min="0" max="${isM ? mw - 1 : ledCount - 1}" value="${e}" oninput="updateLen(${s})" onkeydown="segEnter(${s})"></td><td><input class="segn" id="seg${s}e" type="number" min="0" max="${t}" value="${t}" oninput="updateLen(${s})" onkeydown="segEnter(${s})"></td><td><button class="btn btn-xs" onclick="setSeg(${s});"><i class="icons bth-icon" id="segc${s}">&#xe390;</i></button></td></tr><tr id="mkSYH" class="${isM ? "" : "hide"}"><td>Start Y</td><td>${cfg.comp.seglen ? "Height" : "Stop Y"}</td></tr><tr id="mkSYD" class="${isM ? "" : "hide"}"><td><input class="segn" id="seg${s}sY" type="number" min="0" max="${mh - 1}" value="0" oninput="updateLen(${s})" onkeydown="segEnter(${s})"></td><td><input class="segn" id="seg${s}eY" type="number" min="0" max="${mh}" value="${isM ? mh : 1}" oninput="updateLen(${s})" onkeydown="segEnter(${s})"></td></tr></table><div class="h" id="seg${s}len">${ledCount - e} LEDs</div><div class="c"><button class="btn btn-p" onclick="resetUtil()">Cancel</button></div></div></div>`;
                gId("segutil").innerHTML = n
            }
            function resetUtil(e=!1) {
                gId("segutil").innerHTML = `<div class="seg btn btn-s${e ? " off" : ""}" style="padding:0;"><label class="check schkl"><input type="checkbox" id="selall" onchange="selSegAll(this)"><span class="checkmark"></span></label><div class="segname" ${e ? "" : 'onclick="makeSeg()"'}><i class="icons btn-icon">&#xe18a;</i>Add segment</div><div class="pop hide" onclick="event.stopPropagation();"><i class="icons g-icon" onclick="this.nextElementSibling.classList.toggle('hide');">&#xE34B;</i><div class="pop-c hide"><span style="color:var(--c-f);" onclick="selGrp(0);">&#x278A;</span><span style="color:var(--c-r);" onclick="selGrp(1);">&#x278B;</span><span style="color:var(--c-g);" onclick="selGrp(2);">&#x278C;</span><span style="color:var(--c-l);" onclick="selGrp(3);">&#x278D;</span></div></div></div>`
            }
            function makePlSel(e, t=!1) {
                var s = "";
                delete pJson[0];
                var n = Object.entries(pJson);
                for (var l of n) {
                    var a = l[1].n ? l[1].n : "Preset " + l[0];
                    cfg.comp.idsort && (a = l[0] + " " + a),
                    !t && l[1].playlist && l[1].playlist.ps || (s += `<option value="${l[0]}" ${l[0] == e ? "selected" : ""}>${a}</option>`)
                }
                return s
            }
            function refreshPlE(e) {
                var t = gId("ple" + e);
                if (t) {
                    for (var s = '<div class="first c">Playlist entries</div>', n = 0; n < plJson[e].ps.length; n++)
                        s += makePlEntry(e, n);
                    s += '<div class="hrz"></div>',
                    t.innerHTML = s;
                    var l = t.getElementsByClassName("btn-pl-del");
                    l.length < 2 && (l[0].style.display = "none");
                    var a = gId("seg" + (e + 100)).getElementsByClassName("sel");
                    for (var n of a)
                        n.dataset.val && (parseInt(n.dataset.val) > 0 ? n.value = n.dataset.val : plJson[e].ps[n.dataset.index] = parseInt(n.value))
                }
            }
            function addPl(e, t) {
                plJson[e].ps.splice(t + 1, 0, 0),
                plJson[e].dur.splice(t + 1, 0, plJson[e].dur[t]),
                plJson[e].transition.splice(t + 1, 0, plJson[e].transition[t]),
                refreshPlE(e)
            }
            function delPl(e, t) {
                plJson[e].ps.length < 2 || (plJson[e].ps.splice(t, 1),
                plJson[e].dur.splice(t, 1),
                plJson[e].transition.splice(t, 1),
                refreshPlE(e))
            }
            function plePs(e, t, s) {
                plJson[e].ps[t] = parseInt(s.value)
            }
            function pleDur(e, t, s) {
                s.validity.valid && (plJson[e].dur[t] = Math.floor(10 * s.value))
            }
            function pleTr(e, t, s) {
                s.validity.valid && (plJson[e].transition[t] = Math.floor(10 * s.value))
            }
            function plR(e) {
                var t = plJson[e];
                t.r = gId(`pl${e}rtgl`).checked,
                gId(`pl${e}rptgl`).checked ? (t.repeat = 0,
                delete t.end,
                gId(`pl${e}o1`).style.display = "none") : (t.repeat = parseInt(gId(`pl${e}rp`).value),
                t.end = parseInt(gId(`pl${e}selEnd`).value),
                gId(`pl${e}o1`).style.display = "block")
            }
            function makeP(e, t) {
                var s = "";
                if (t) {
                    0 === e && (plJson[0] = {
                        ps: [1],
                        dur: [100],
                        transition: [tr],
                        repeat: 0,
                        r: !1,
                        end: 0
                    });
                    var n = plJson[e].repeat ? plJson[e].repeat : 0;
                    s = `<div id="ple${e}" style="margin-top:10px;"></div><label class="check revchkl">Shuffle\n <input type="checkbox" id="pl${e}rtgl" onchange="plR(${e})" ${plJson[e].r || n < 0 ? "checked" : ""}>\n <span class="checkmark"></span>\n</label>\n<label class="check revchkl">Repeat indefinitely\n <input type="checkbox" id="pl${e}rptgl" onchange="plR(${e})" ${n > 0 ? "" : "checked"}>\n <span class="checkmark"></span>\n</label>\n<div id="pl${e}o1" style="display:${n > 0 ? "block" : "none"}">\n<div class="c">Repeat <input type="number" id="pl${e}rp" oninput="plR(${e})" max=127 min=0 value=${n > 0 ? n : 1}> times</div>\n<div class="sel">End preset:<br>\n<div class="sel-p"><select class="sel-ple" id="pl${e}selEnd" onchange="plR(${e})" data-val=${plJson[e].end ? plJson[e].end : 0}>\n<option value="0">None</option>\n<option value="255">Restore preset</option>\n${makePlSel(plJson[e].end ? plJson[e].end : 0, !0)}\n</select></div></div>\n</div>\n<div class="c"><button class="btn btn-p" onclick="testPl(${e}, this)"><i class='icons btn-icon'>&#xe139;</i>Test</button></div>`
                } else if (s = `<label class="check revchkl">\n <span class="lstIname">\n Include brightness\n </span>\n <input type="checkbox" id="p${e}ibtgl" checked>\n <span class="checkmark"></span>\n</label>\n<label class="check revchkl">\n <span class="lstIname">\n Save segment bounds\n </span>\n <input type="checkbox" id="p${e}sbtgl" checked>\n <span class="checkmark"></span>\n</label>\n<label class="check revchkl">\n <span class="lstIname">\n Checked segments only\n </span>\n <input type="checkbox" id="p${e}sbchk">\n <span class="checkmark"></span>\n</label>`,
                Array.isArray(lastinfo.maps) && lastinfo.maps.length > 1) {
                    s += `<div class="lbl-l">Ledmap:&nbsp;<div class="sel-p"><select class="sel-p" id="p${e}lmp"><option value="">Unchanged</option>`;
                    for (const t of lastinfo.maps || [])
                        s += `<option value="${t.id}"${e > 0 && pJson[e].ledmap == t.id ? " selected" : ""}>${0 == t.id ? "Default" : t.n ? t.n : "ledmap" + t.id + ".json"}</option>`;
                    s += "</select></div></div>"
                }
                return `<input type="text" class="ptxt ${0 == e ? "show" : ""}" id="p${e}txt" autocomplete="off" maxlength=32 value="${e > 0 ? pName(e) : ""}" placeholder="Enter name..."/>\n<div class="c">Quick load label: <input type="text" class="stxt" maxlength=2 value="${qlName(e)}" id="p${e}ql" autocomplete="off"/></div>\n<div class="h">(leave empty for no Quick load button)</div>\n<div ${t && 0 == e ? "style='display:none'" : ""}>\n<label class="check revchkl">\n <span class="lstIname">\n ${t ? "Show playlist editor" : e > 0 ? "Overwrite with state" : "Use current state"}\n </span>\n <input type="checkbox" id="p${e}cstgl" onchange="tglCs(${e})" ${0 == e || t ? "checked" : ""}>\n <span class="checkmark"></span>\n</label>\n</div>\n<div class="po2" id="p${e}o2">API command<br><textarea class="apitxt" id="p${e}api"></textarea></div>\n<div class="po1" id="p${e}o1">${s}</div>\n<div class="c m6">Save to ID <input id="p${e}id" type="number" oninput="checkUsed(${e})" max=250 min=1 value=${e > 0 ? e : getLowestUnusedP()}></div>\n<div class="c">\n <button class="btn btn-p" onclick="saveP(${e},${t})"><i class="icons btn-icon">&#xe390;</i>Save</button>\n ${e > 0 ? '<button class="btn btn-p" id="p' + e + 'del" onclick="delP(' + e + ')"><i class="icons btn-icon">&#xe037;</i>Delete' : '<button class="btn btn-p" onclick="resetPUtil()">Cancel'}</button>\n</div>\n<div class="pwarn ${e > 0 ? "bp" : ""} c" id="p${e}warn"></div>\n${e > 0 ? '<div class="h">ID ' + e + "</div>" : ""}`
            }
            function makePUtil() {
                let e = gId("putil");
                e.classList.remove("staybot"),
                e.classList.add("pres"),
                e.innerHTML = `<div class="presin expanded">${makeP(0)}</div>`;
                let t = gId("p0txt");
                t.focus(),
                t.value = eJson.find(e => e.id == selectedFx).name,
                t.select(),
                e.scrollIntoView({
                    behavior: "smooth",
                    block: "center"
                }),
                gId("psFind").classList.remove("staytop")
            }
            function makePlEntry(e, t) {
                return `<div class="plentry">\n <div class="hrz"></div>\n <table>\n <tr>\n  <td width="80%" colspan=2>\n   <div class="sel-p"><select class="sel-pl" onchange="plePs(${e},${t},this)" data-val="${plJson[e].ps[t]}" data-index="${t}">\n   ${makePlSel(plJson[e].ps[t])}\n   </select></div>\n  </td>\n  <td class="c"><button class="btn btn-pl-add" onclick="addPl(${e},${t})"><i class="icons btn-icon">&#xe18a;</i></button></td>\n </tr>\n <tr>\n  <td class="c">Duration</td>\n  <td class="c">Transition</td>\n  <td class="c">#${t + 1}</td>\n </tr>\n <tr>\n  <td class="c" width="40%"><input class="segn" type="number" placeholder="Duration" max=6553.0 min=0.2 step=0.1 oninput="pleDur(${e},${t},this)" value="${plJson[e].dur[t] / 10}">s</td>\n  <td class="c" width="40%"><input class="segn" type="number" placeholder="Transition" max=65.0 min=0.0 step=0.1 oninput="pleTr(${e},${t},this)" value="${plJson[e].transition[t] / 10}">s</td>\n  <td class="c"><button class="btn btn-pl-del" onclick="delPl(${e},${t})"><i class="icons btn-icon">&#xe037;</i></button></div></td>\n </tr>\n </table>\n</div>`
            }
            function makePlUtil() {
                pNum < 2 && showToast("You need at least 2 presets to make a playlist!");
                let e = gId("putil");
                e.classList.remove("staybot"),
                e.classList.add("pres"),
                e.innerHTML = `<div class="presin expanded" id="seg100">${makeP(0, !0)}</div></div>`,
                refreshPlE(0),
                gId("p0txt").focus(),
                e.scrollIntoView({
                    behavior: "smooth",
                    block: "center"
                }),
                gId("psFind").classList.remove("staytop")
            }
            function resetPUtil() {
                gId("psFind").classList.add("staytop");
                let e = gId("putil");
                e.classList.add("staybot"),
                e.classList.remove("pres"),
                e.innerHTML = '<button class="btn btn-s" onclick="makePUtil()" style="float:left;"><i class="icons btn-icon">&#xe18a;</i>Preset</button><button class="btn btn-s" onclick="makePlUtil()" style="float:right;"><i class="icons btn-icon">&#xe18a;</i>Playlist</button>'
            }
            function tglCs(e) {
                var t = gId(`p${e}cstgl`).checked;
                gId(`p${e}o1`).style.display = t ? "block" : "none",
                gId(`p${e}o2`).style.display = t ? "none" : "block"
            }
            function tglSegn(e) {
                let t = gId(e < 100 ? `seg${e}t` : `p${e - 100}txt`);
                t && (t.classList.toggle("show"),
                t.focus(),
                t.select()),
                event.preventDefault(),
                event.stopPropagation()
            }
            function selSegAll(e) {
                var t = {
                    seg: []
                };
                for (let s = 0; s <= lSeg; s++)
                    gId("seg" + s) && t.seg.push({
                        id: s,
                        sel: e.checked
                    });
                requestJson(t)
            }
            function selSegEx(e) {
                var t = {
                    seg: []
                };
                for (let s = 0; s <= lSeg; s++)
                    gId("seg" + s) && t.seg.push({
                        id: s,
                        sel: s == e
                    });
                t.mainseg = e,
                requestJson(t)
            }
            function selSeg(e) {
                requestJson({
                    seg: {
                        id: e,
                        sel: gId(`seg${e}sel`).checked
                    }
                })
            }
            function selGrp(e) {
                event.preventDefault(),
                event.stopPropagation();
                var t = gId("segcont").querySelectorAll(`div[data-set="${e}"]`)
                  , s = {
                    seg: []
                };
                for (let e = 0; e <= lSeg; e++)
                    gId("seg" + e) && s.seg.push({
                        id: e,
                        sel: !1
                    });
                if (t)
                    for (let e of t || []) {
                        let t = parseInt(e.id.substring(3));
                        s.seg[t] = {
                            id: t,
                            sel: !0
                        }
                    }
                s.seg.length && requestJson(s)
            }
            function rptSeg(e) {
                var t = gId(`seg${e}t`).value
                  , s = parseInt(gId(`seg${e}s`).value)
                  , n = parseInt(gId(`seg${e}e`).value);
                if (0 != n) {
                    var l = gId(`seg${e}rev`).checked
                      , a = gId(`seg${e}mi`).checked
                      , o = gId(`seg${e}sel`).checked
                      , i = gId(`seg${e}pwr`).classList.contains("act")
                      , r = {
                        seg: {
                            id: e,
                            n: t,
                            start: s,
                            stop: (cfg.comp.seglen ? s : 0) + n,
                            rev: l,
                            mi: a,
                            on: i,
                            bri: parseInt(gId(`seg${e}bri`).value),
                            sel: o
                        }
                    };
                    if (gId(`seg${e}grp`)) {
                        var c = parseInt(gId(`seg${e}grp`).value)
                          , d = parseInt(gId(`seg${e}spc`).value)
                          , p = parseInt(gId(`seg${e}of`).value);
                        r.seg.grp = c,
                        r.seg.spc = d,
                        r.seg.of = p
                    }
                    r.seg.rpt = !0,
                    expand(e),
                    requestJson(r)
                }
            }
            function setSeg(e) {
                var t = gId(`seg${e}t`).value;
                let s = gId(`seg${e}s`)
                  , n = gId(`seg${e}e`);
                var l = parseInt(s.value)
                  , a = parseInt(n.value) + (cfg.comp.seglen ? l : 0);
                if (l < s.min || l > s.max)
                    return void (s.value = s.min);
                if (a < n.min || a - (cfg.comp.seglen ? l : 0) > n.max)
                    return void (n.value = n.max);
                if (cfg.comp.seglen && 0 == a || !cfg.comp.seglen && a <= l)
                    return void delSeg(e);
                var o = {
                    seg: {
                        id: e,
                        n: t,
                        start: l,
                        stop: a
                    }
                };
                if (isM && l < mw * mh) {
                    let t = gId(`seg${e}sY`)
                      , s = gId(`seg${e}eY`);
                    var i = parseInt(t.value)
                      , r = parseInt(s.value) + (cfg.comp.seglen ? i : 0);
                    if (i < t.min || i > t.max)
                        return void (t.value = t.min);
                    if (r < s.min || r > s.max)
                        return void (s.value = s.max);
                    o.seg.startY = i,
                    o.seg.stopY = r
                }
                let c = gId(`seg${e}grp`);
                if (c) {
                    let t = parseInt(c.value)
                      , s = parseInt(gId(`seg${e}spc`).value)
                      , n = parseInt(gId(`seg${e}of`).value);
                    o.seg.grp = t,
                    o.seg.spc = s,
                    o.seg.of = n,
                    isM && gId(`seg${e}tp`) && (o.seg.tp = gId(`seg${e}tp`).checked)
                }
                resetUtil(),
                requestJson(o)
            }
            function delSeg(e) {
                segCount < 2 ? showToast("You need to have multiple segments to delete one!") : (segCount--,
                requestJson({
                    seg: {
                        id: e,
                        stop: 0
                    }
                }))
            }
            function setRev(e) {
                requestJson({
                    seg: {
                        id: e,
                        rev: gId(`seg${e}rev`).checked
                    }
                })
            }
            function setRevY(e) {
                requestJson({
                    seg: {
                        id: e,
                        rY: gId(`seg${e}rY`).checked
                    }
                })
            }
            function setMi(e) {
                requestJson({
                    seg: {
                        id: e,
                        mi: gId(`seg${e}mi`).checked
                    }
                })
            }
            function setMiY(e) {
                requestJson({
                    seg: {
                        id: e,
                        mY: gId(`seg${e}mY`).checked
                    }
                })
            }
            function setM12(e) {
                requestJson({
                    seg: {
                        id: e,
                        m12: gId(`seg${e}m12`).selectedIndex
                    }
                })
            }
            function setSi(e) {
                requestJson({
                    seg: {
                        id: e,
                        si: gId(`seg${e}si`).selectedIndex
                    }
                })
            }
            function setTp(e) {
                requestJson({
                    seg: {
                        id: e,
                        tp: gId(`seg${e}tp`).checked
                    }
                })
            }
            function setGrp(e, t) {
                event.preventDefault(),
                event.stopPropagation(),
                requestJson({
                    seg: {
                        id: e,
                        set: t
                    }
                })
            }
            function setSegPwr(e) {
                requestJson({
                    seg: {
                        id: e,
                        on: !gId(`seg${e}pwr`).classList.contains("act")
                    }
                })
            }
            function setSegBri(e) {
                requestJson({
                    seg: {
                        id: e,
                        bri: parseInt(gId(`seg${e}bri`).value)
                    }
                })
            }
            function tglFreeze(e=null) {
                var t = {
                    seg: {
                        frz: "t"
                    }
                };
                null !== e && (t.seg.id = e,
                lastinfo && e == lastinfo.liveseg && lastinfo.live && (t = {
                    lor: 1
                })),
                requestJson(t)
            }
            function setFX(e=null) {
                null === e ? e = parseInt(d.querySelector('#fxlist input[name="fx"]:checked').value) : d.querySelector(`#fxlist input[name="fx"][value="${e}"]`).checked = !0,
                requestJson({
                    seg: {
                        fx: parseInt(e),
                        fxdef: cfg.comp.fxdef
                    }
                })
            }
            function setPalette(e=null) {
                null === e ? e = parseInt(d.querySelector('#pallist input[name="palette"]:checked').value) : d.querySelector(`#pallist input[name="palette"][value="${e}"]`).checked = !0,
                requestJson({
                    seg: {
                        pal: e
                    }
                })
            }
            function setBri() {
                requestJson({
                    bri: parseInt(gId("sliderBri").value)
                })
            }
            function setSpeed() {
                requestJson({
                    seg: {
                        sx: parseInt(gId("sliderSpeed").value)
                    }
                })
            }
            function setIntensity() {
                requestJson({
                    seg: {
                        ix: parseInt(gId("sliderIntensity").value)
                    }
                })
            }
            function setCustom(e=1) {
                if (!(e < 1 || e > 3)) {
                    var t = {
                        seg: {}
                    }
                      , s = parseInt(gId("sliderC" + e).value);
                    3 === e ? t.seg.c3 = s : 2 === e ? t.seg.c2 = s : t.seg.c1 = s,
                    requestJson(t)
                }
            }
            function setOption(e=1, t=!1) {
                if (!(e < 1 || e > 3)) {
                    var s = {
                        seg: {}
                    };
                    3 === e ? s.seg.o3 = !!t : 2 === e ? s.seg.o2 = !!t : s.seg.o1 = !!t,
                    requestJson(s)
                }
            }
            function setLor(e) {
                requestJson({
                    lor: e
                })
            }
            function setPreset(e) {
                var t = {
                    ps: e
                };
                !isPlaylist(e) && pJson && pJson[e] && (!pJson[e].win || pJson[e].win.indexOf("Please") <= 0) && (t = {
                    pd: e
                },
                Object.assign(t, pJson[e]),
                delete t.ql,
                delete t.n),
                isPlaylist(e) && (t.on = !0),
                showToast("Loading preset " + pName(e) + " (" + e + ")"),
                requestJson(t)
            }
            function saveP(e, t) {
                if ((!(pI = parseInt(gId(`p${e}id`).value)) || pI < 1) && (pI = e > 0 ? e : getLowestUnusedP()),
                pI > 250)
                    alert("Preset ID must be 250 or less.");
                else {
                    "" == (pN = gId(`p${e}txt`).value) && (pN = (t ? "Playlist " : "Preset ") + pI);
                    var s = {};
                    if (gId(`p${e}cstgl`).checked)
                        t ? (s.playlist = plJson[e],
                        s.on = !0,
                        s.o = !0) : (s.ib = gId(`p${e}ibtgl`).checked,
                        s.sb = gId(`p${e}sbtgl`).checked,
                        s.sc = gId(`p${e}sbchk`).checked,
                        gId(`p${e}lmp`) && "" !== gId(`p${e}lmp`).value && (s.ledmap = parseInt(gId(`p${e}lmp`).value)));
                    else {
                        var n = gId(`p${e}api`).value;
                        try {
                            s = JSON.parse(n)
                        } catch (t) {
                            if (s.win = n,
                            n.length < 2)
                                return void (gId(`p${e}warn`).innerHTML = "&#9888; Please enter your API command first");
                            if (n.indexOf("{") > -1)
                                return void (gId(`p${e}warn`).innerHTML = "&#9888; Syntax error in custom JSON API command");
                            if (0 == n.indexOf("Please"))
                                return void (gId(`p${e}warn`).innerHTML = "&#9888; Please refresh the page before modifying this preset")
                        }
                        s.o = !0
                    }
                    s.psave = pI,
                    s.n = pN;
                    var l = gId(`p${e}ql`).value;
                    l.length > 0 && (s.ql = l),
                    showToast("Saving " + pN + " (" + pI + ")"),
                    requestJson(s),
                    s.o ? (pJson[pI] = s,
                    delete pJson[pI].psave,
                    delete pJson[pI].o,
                    delete pJson[pI].v,
                    delete pJson[pI].time) : (pJson[pI] = {
                        n: pN,
                        win: "Please refresh the page to see this newly saved command."
                    },
                    s.win && (pJson[pI].win = s.win),
                    s.ql && (pJson[pI].ql = s.ql)),
                    populatePresets(),
                    resetPUtil(),
                    setTimeout( () => {
                        pmtLast = 0,
                        loadPresets()
                    }
                    , 750)
                }
            }
            function testPl(e, t) {
                if (1 == t.dataset.test)
                    return t.dataset.test = 0,
                    t.innerHTML = "<i class='icons btn-icon'>&#xe139;</i>Test",
                    void stopPl();
                t.dataset.test = 1,
                t.innerHTML = "<i class='icons btn-icon'>&#xe38f;</i>Stop";
                var s = {};
                s.playlist = plJson[e],
                s.on = !0,
                requestJson(s)
            }
            function stopPl() {
                requestJson({
                    playlist: {}
                })
            }
            function delP(e) {
                var t = gId(`p${e}del`);
                1 == t.dataset.cnf ? (requestJson({
                    pdel: e
                }),
                delete pJson[e],
                populatePresets(),
                gId("putil").classList.add("staybot")) : (t.style.color = "var(--c-r)",
                t.innerHTML = "<i class='icons btn-icon'>&#xe037;</i>Delete!",
                t.dataset.cnf = 1)
            }
            function selectSlot(e) {
                csel = e;
                var t = gId("csl").children;
                for (let e of t)
                    e.classList.remove("xxs-w");
                t[e].classList.add("xxs-w"),
                setPicker(rgbStr(t[e].dataset)),
                0 == cpick.color.value && updatePSliders(),
                gId("sliderW").value = parseInt(t[e].dataset.w),
                updateTrail(gId("sliderW")),
                redrawPalPrev()
            }
            var lasth = 0;
            function pC(e) {
                if ("rnd" == e) {
                    (e = {
                        h: 0,
                        s: 0,
                        v: 100
                    }).s = Math.floor(50 * Math.random() + 50);
                    do {
                        e.h = Math.floor(360 * Math.random())
                    } while (Math.abs(e.h - lasth) < 50);
                    lasth = e.h
                }
                setPicker(e),
                setColor(0)
            }
            function updatePSliders() {
                var e = cpick.color.rgb;
                gId("sliderR").value = e.r,
                gId("sliderG").value = e.g,
                gId("sliderB").value = e.b;
                var t, s = cpick.color.hexString.substring(1), n = parseInt(gId("csl").children[csel].dataset.w);
                n > 0 && (s += n.toString(16)),
                gId("hexc").value = s,
                gId("hexcnf").style.backgroundColor = "var(--c-3)";
                let l = cpick.color.hue
                  , a = cpick.color.saturation
                  , o = cpick.color.value;
                gId("sliderH").value = l,
                gId("sliderS").value = a,
                gId("sliderV").value = o,
                t = iro.Color.hsvToRgb({
                    h: l,
                    s: 100,
                    v: 100
                }),
                gId("sliderS").nextElementSibling.style.backgroundImage = "linear-gradient(90deg, #aaa -15%, rgb(" + t.r + "," + t.g + "," + t.b + "))",
                t = iro.Color.hsvToRgb({
                    h: l,
                    s: a,
                    v: 100
                }),
                gId("sliderV").nextElementSibling.style.backgroundImage = "linear-gradient(90deg, #000 -15%, rgb(" + t.r + "," + t.g + "," + t.b + "))",
                gId("sliderK").value = cpick.color.kelvin
            }
            function hexEnter() {
                13 == event.keyCode && fromHex()
            }
            function segEnter(e) {
                13 == event.keyCode && setSeg(e)
            }
            function fromHex() {
                var e = gId("hexc").value;
                let t = parseInt(e.substring(6), 16);
                try {
                    setPicker("#" + e.substring(0, 6))
                } catch (e) {
                    setPicker("#ffaa00")
                }
                gId("csl").children[csel].dataset.w = isNaN(t) ? 0 : t,
                setColor(2)
            }
            function setPicker(e) {
                var t = new iro.Color(e);
                t.value > 0 ? cpick.color.set(t) : cpick.color.setChannel("hsv", "v", 0),
                updateTrail(gId("sliderR")),
                updateTrail(gId("sliderG")),
                updateTrail(gId("sliderB"))
            }
            function fromH() {
                cpick.color.setChannel("hsv", "h", gId("sliderH").value)
            }
            function fromS() {
                cpick.color.setChannel("hsv", "s", gId("sliderS").value)
            }
            function fromV() {
                cpick.color.setChannel("hsv", "v", gId("sliderV").value)
            }
            function fromK() {
                cpick.color.set({
                    kelvin: gId("sliderK").value
                })
            }
            function fromRgb() {
                var e = gId("sliderR").value
                  , t = gId("sliderG").value
                  , s = gId("sliderB").value;
                setPicker(`rgb(${e},${t},${s})`);
                let n = gId("csl").children;
                n[csel].dataset.r = e,
                n[csel].dataset.g = t,
                n[csel].dataset.b = s,
                setCSL(n[csel])
            }
            function fromW() {
                let e = gId("sliderW")
                  , t = gId("csl").children;
                t[csel].dataset.w = e.value,
                setCSL(t[csel]),
                updateTrail(e)
            }
            function setColor(e) {
                var t = gId("csl").children;
                let s, n, l, a = t[csel].dataset, o = 0;
                1 == e && isRgbBlack(a) && cpick.color.setChannel("hsv", "v", 100),
                2 != e && hasWhite && (o = parseInt(gId("sliderW").value));
                var i = cpick.color.rgb;
                a.r = s = hasRGB ? i.r : o,
                a.g = n = hasRGB ? i.g : o,
                a.b = l = hasRGB ? i.b : o,
                a.w = o,
                setCSL(t[csel]);
                var r = {
                    seg: {
                        col: [[], [], []]
                    }
                };
                r.seg.col[csel] = [s, n, l, o],
                requestJson(r)
            }
            function setBalance(e) {
                requestJson({
                    seg: {
                        cct: parseInt(e)
                    }
                })
            }
            function rmtTgl(e, t) {
                event.preventDefault(),
                event.stopPropagation(),
                fetch(`http://${e}/win&T=2`, {
                    method: "get"
                }).then(e => e.text()).then(e => {
                    "0" === (new window.DOMParser).parseFromString(e, "text/xml").getElementsByTagName("ac")[0].textContent ? t.classList.add("off") : t.classList.remove("off")
                }
                )
            }
            var hc = 0;
            function openGH() {
                window.open("https://github.com/Aircoookie/WLED/wiki")
            }
            setInterval( () => {
                isInfo && ((hc += 18) > 300 && (hc = 0),
                hc > 200 && (hc = 306),
                144 == hc && (hc += 36),
                108 == hc && (hc += 18),
                gId("heart").style.color = `hsl(${hc}, 100%, 50%)`)
            }
            , 910);
            var cnfr = !1;
            function cnfReset() {
                if (!cnfr) {
                    var e = gId("resetbtn");
                    return e.style.color = "var(--c-r)",
                    e.innerHTML = "Confirm Reboot",
                    void (cnfr = !0)
                }
                window.location.href = getURL("/reset")
            }
            var cnfrS = !1;
            function rSegs() {
                var e = gId("rsbtn");
                if (!cnfrS)
                    return e.style.color = "var(--c-r)",
                    e.innerHTML = "Confirm reset",
                    void (cnfrS = !0);
                cnfrS = !1,
                e.style.color = "var(--c-f)",
                e.innerHTML = "Reset segments";
                var t = {
                    seg: [{
                        start: 0,
                        stop: ledCount,
                        sel: !0
                    }]
                };
                isM && (t.seg[0].stop = mw,
                t.seg[0].startX = 0,
                t.seg[0].stopY = mh);
                for (let e = 1; e <= lSeg; e++)
                    t.seg.push({
                        stop: 0
                    });
                requestJson(t)
            }
            function loadPalettesData(e=null) {
                if (palettesData)
                    return;
                var t = localStorage.getItem("wledPalx");
                if (t)
                    try {
                        var s = JSON.parse(t);
                        if (s && s.vid == s.vid)
                            return palettesData = s.p,
                            void (e && e())
                    } catch (e) {}
                palettesData = {},
                getPalettesData(0, () => {
                    localStorage.setItem("wledPalx", JSON.stringify({
                        p: palettesData,
                        vid: lastinfo.vid
                    })),
                    redrawPalPrev(),
                    e && setTimeout(e, 99)
                }
                )
            }
            function getPalettesData(e, t) {
                fetch(getURL("/json/palx?page=" + e), {
                    method: "get",
                    headers: {
                        "Content-type": "application/json; charset=UTF-8"
                    }
                }).then(e => (e.ok || showErrorToast(),
                e.json())).then(s => {
                    palettesData = Object.assign({}, palettesData, s.p),
                    e < s.m ? setTimeout( () => {
                        getPalettesData(e + 1, t)
                    }
                    , 50) : t()
                }
                ).catch(e => {
                    showToast(e, !0)
                }
                )
            }
            function search(e, t=null) {
                if (e.nextElementSibling.style.display = "" !== e.value ? "block" : "none",
                t) {
                    var s = gId(t).querySelectorAll(".lstI");
                    for (i = "pcont" === t ? 0 : 1; i < s.length; i++) {
                        var n = s[i]
                          , l = n.querySelector(".lstIname").innerText.toUpperCase();
                        n.style.display = l.indexOf(e.value.toUpperCase()) < 0 ? "none" : ""
                    }
                }
            }
            function clean(e) {
                e.style.display = "none";
                var t = e.previousElementSibling;
                t.value = "",
                t.focus(),
                t.dispatchEvent(new Event("input")),
                "fxFind" == t.parentElement.id && gId("filters").querySelectorAll("input[type=checkbox]").forEach(e => {
                    e.checked = !1
                }
                )
            }
            function filterFx(e) {
                if (!e)
                    return;
                let t = gId("fxFind").children[0];
                t.value = e.checked ? e.dataset.flt : "",
                t.focus(),
                t.dispatchEvent(new Event("input")),
                gId("filters").querySelectorAll("input[type=checkbox]").forEach(t => {
                    t !== e && (t.checked = !1)
                }
                )
            }
            function formatArr(e) {
                var t, s = e.ps.length;
                if (!Array.isArray(e.dur)) {
                    var n = e.dur;
                    isNaN(n) && (n = 100),
                    e.dur = [n]
                }
                if ((t = e.dur.length) < s)
                    for (var l = 0; l < s - t; l++)
                        e.dur.push(e.dur[t - 1]);
                if (!Array.isArray(e.transition)) {
                    n = e.transition;
                    isNaN(n) && (n = tr),
                    e.transition = [n]
                }
                if ((t = e.transition.length) < s)
                    for (l = 0; l < s - t; l++)
                        e.transition.push(e.transition[t - 1])
            }
            function expand(e) {
                var t = gId(e < 100 ? "seg" + e : `p${e - 100}o`);
                let s = gId("pcont").children;
                if (e > 100)
                    for (let e of s)
                        e.classList.remove("selected"),
                        e !== t && e.classList.remove("expanded");
                if (t.classList.toggle("expanded"),
                e >= 100) {
                    var n = e - 100;
                    if (t.classList.contains("expanded")) {
                        isPlaylist(n) ? (plJson[n] = pJson[n].playlist,
                        formatArr(plJson[n]),
                        isNaN(plJson[n].repeat) && (plJson[n].repeat = 0),
                        plJson[n].r || (plJson[n].r = !1),
                        isNaN(plJson[n].end) && (plJson[n].end = 0),
                        gId("seg" + e).innerHTML = makeP(n, !0),
                        refreshPlE(n)) : gId("seg" + e).innerHTML = makeP(n);
                        var l = papiVal(n);
                        gId(`p${n}api`).value = l,
                        0 == l.indexOf("Please") && (gId(`p${n}cstgl`).checked = !1),
                        tglCs(n),
                        gId("putil").classList.remove("staybot")
                    } else
                        updatePA(),
                        gId("seg" + e).innerHTML = "",
                        gId("putil").classList.add("staybot")
                }
                t.scrollIntoView({
                    behavior: "smooth",
                    block: "center"
                })
            }
            function unfocusSliders() {
                gId("sliderBri").blur(),
                gId("sliderSpeed").blur(),
                gId("sliderIntensity").blur()
            }
            const _C = d.querySelector(".container")
              , N = 4;
            let iSlide = 0
              , x0 = null
              , scrollS = 0
              , locked = !1;
            function unify(e) {
                return e.changedTouches ? e.changedTouches[0] : e
            }
            function hasIroClass(e) {
                for (var t = 0; t < e.length; t++) {
                    if (e[t].startsWith("Iro"))
                        return !0
                }
                return !1
            }
            function lock(e) {
                if (!pcMode) {
                    var t = e.target.classList
                      , s = e.target.parentElement.classList;
                    t.contains("noslide") || hasIroClass(t) || hasIroClass(s) || (x0 = unify(e).clientX,
                    scrollS = gEBCN("tabcontent")[iSlide].scrollTop,
                    _C.classList.toggle("smooth", !(locked = !0)))
                }
            }
            function move(e) {
                if (locked && !pcMode) {
                    var t = unify(e).clientX
                      , s = t - x0
                      , n = Math.sign(s)
                      , l = +(n * s / wW).toFixed(2);
                    0 != t && (iSlide > 0 || n < 0) && (iSlide < 3 || n > 0) && l > .12 && gEBCN("tabcontent")[iSlide].scrollTop == scrollS && (_C.style.setProperty("--i", iSlide -= n),
                    l = 1 - l,
                    updateTablinks(iSlide)),
                    _C.style.setProperty("--f", l),
                    _C.classList.toggle("smooth", !(locked = !1)),
                    x0 = null
                }
            }
            function size() {
                wW = window.innerWidth;
                var e = gId("top").clientHeight;
                sCol("--th", e + "px"),
                sCol("--bh", gId("bot").clientHeight + "px"),
                isLv && (e -= 4),
                sCol("--tp", e + "px"),
                togglePcMode(),
                lastw = wW
            }
            function togglePcMode(e=!1) {
                e && (pcModeA = !pcModeA,
                localStorage.setItem("pcm", pcModeA)),
                pcMode = wW >= 1024 && pcModeA,
                cpick && cpick.resize(pcMode && wW > 1023 && wW < 1250 ? 230 : 260),
                !e && (wW < 1024 && lastw < 1024 || wW >= 1024 && lastw >= 1024) || (openTab(0, !0),
                updateTablinks(0),
                gId("buttonPcm").className = pcMode ? "active" : "",
                gId("bot").style.height = pcMode && !cfg.comp.pcmbot ? "0" : "auto",
                sCol("--bh", gId("bot").clientHeight + "px"),
                _C.style.width = pcMode ? "100%" : "400%")
            }
            function mergeDeep(e, ...t) {
                if (!t.length)
                    return e;
                const s = t.shift();
                if (isObj(e) && isObj(s))
                    for (const t in s)
                        isObj(s[t]) ? (e[t] || Object.assign(e, {
                            [t]: {}
                        }),
                        mergeDeep(e[t], s[t])) : Object.assign(e, {
                            [t]: s[t]
                        });
                return mergeDeep(e, ...t)
            }
            size(),
            _C.style.setProperty("--n", 4),
            window.addEventListener("resize", size, !0),
            _C.addEventListener("mousedown", lock, !1),
            _C.addEventListener("touchstart", lock, !1),
            _C.addEventListener("mouseout", move, !1),
            _C.addEventListener("mouseup", move, !1),
            _C.addEventListener("touchend", move, !1)
        </script>
    </body>
</html>